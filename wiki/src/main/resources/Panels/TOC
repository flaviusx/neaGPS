<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>Panels</web>
<name>TOC</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.LudovicDubost</creator>
<author>XWiki.LudovicDubost</author>
<customClass></customClass>
<contentAuthor>XWiki.LudovicDubost</contentAuthor>
<creationDate>1190211387000</creationDate>
<date>1194298987000</date>
<contentUpdateDate>1194298987000</contentUpdateDate>
<version>1.44</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment>Fixed wiki syntax in TOC</comment>
<object>
<class>
<name>Panels.PanelClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<category>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>category</name>
<number>5</number>
<prettyName>Category</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>Information|Navigation|Tools|Administration|Other</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</category>
<content>
<editor>Text</editor>
<name>content</name>
<number>4</number>
<prettyName>Content</prettyName>
<rows>25</rows>
<size>60</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</content>
<description>
<editor>Text</editor>
<name>description</name>
<number>3</number>
<prettyName>Description</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</description>
<name>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>40</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<type>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>type</name>
<number>2</number>
<prettyName>Panel type</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>view|edit</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</type>
</class>
<name>Panels.TOC</name>
<number>0</number>
<className>Panels.PanelClass</className>
<property>
<category>Information</category>
</property>
<property>
<content>{pre}
#set($assetObj = $doc.getObject("XWiki.AssetClass"))
#if($assetObj)
&lt;style type="text/css"&gt;
.collapsed ul {
  display: none;
}
&lt;/style&gt;
#macro(addli $assetDoc $istree $addbc)
#if($istree)
#set($cookiebase = "${startDoc.fullName}_")
#if(!$navcatcounter)
#set($navcatcounter = 1)
#else
#set($navcatcounter = $navcatcounter + 1)
#end
#set($id = "assettree_${navcatcounter}")
#if($expanded == true)
#set($cookiemagic = "if(expanded) createCookie('${cookiebase}${id}','false', ''); else eraseCookie('${cookiebase}${id}');")
#else
#set($cookiemagic = "if(expanded) eraseCookie('${cookiebase}${id}'); else createCookie('${cookiebase}${id}', 'true', '');")
#end
#set($exp2 = "")
#set($exp2 = $xwiki.getUserPreferenceFromCookie("${cookiebase}$id"))
#if(!$exp2.equals(""))
#if($exp2 == 'true')
#set($expanded = true)
#else
#set($expanded = false)
#end
#end
#set($onclick = "event.cancelBubble = true; var expanded = eltHasClass(this.parentNode, 'expanded'); ${cookiemagic} togglePanelVisibility(this)")
&lt;li id="${id}" #if($doc.fullName==$assetDoc.fullName) class="treeitem selected #if($expanded) expanded #else collapsed #end" #else class="treeitem #if($expanded) expanded #else collapsed #end" #end onclick="${onclick}" &gt;
&lt;img src="$xwiki.getSkinFile("pixel.gif")" width="14" height="14" /&gt;
&lt;a onclick="event.cancelBubble = true;" href="$assetDoc.getURL("view", "bc=$!bc$!addbc")"&gt;
$currikiTitle
&lt;/a&gt;
#if(!$expanded)
&lt;script type="text/javascript"&gt;
togglePanelVisibility(document.getElementById("${id}"));
&lt;/script&gt;
#end
#else
&lt;li id="${id}" #if($doc.fullName==$assetDoc.fullName) class="selected" #end&gt;
&lt;a onclick="event.cancelBubble = true;" href="$assetDoc.getURL("view", "bc=$!bc$!addbc")"&gt;
$currikiTitle
&lt;/a&gt;
#end
#end
#set($ok = $doc.use($assetObj))
&lt;div class="panel expanded"&gt;
&lt;h5 class="xwikipaneltitle" onclick="togglePanelVisibility(this.parentNode);"&gt;$msg.get("curriki.toc.title")&lt;/h5&gt;
&lt;div class="xwikipanelcontents toc"&gt;
&lt;img src="$xwiki.getSkinFile("arrow-red.png")" /&gt;
#set($bc = $!request.bc)
#set($startDoc = $doc)
#set($subAssets = $doc.getObjects("XWiki.SubAssetClass"))
#if(((!$subAssets)||($subAssets.size()==0))&amp;&amp;$request.bc)
## then we are on a source asset we should look at it in the content of it's parent
#set($bc = "")
#set($parent = "")
#foreach($bcItem in $request.bc.split(";"))
#if($parent!="")
#if($bc!="")
#set($bc = "$!bc;")
#end
#set($bc="$!bc$!parent")
#end
#set($parent = $bcItem)
#end
#set($startDoc = $xwiki.getDocument($parent))
#end
#findCurrikiTitle($startDoc)
&lt;div class="curriki_toc"&gt;
&lt;ul&gt;
#set($objs = $startDoc.getObjects("XWiki.SubAssetClass"))
#set($assetList = $xwiki.arrayList)
#foreach($obj in $objs)
#set($ok = $assetList.add(""))
#end
#foreach($obj in $objs)
#set($ok = $startDoc.use($obj))
#set($position = $startDoc.getValue("order"))
#set($assetPage = $startDoc.getValue("assetpage"))
#if($position &gt;= $assetList.size())
#set($ok = $assetList.add($assetPage))
#else
#set($ok = $assetList.set($position.intValue(), $assetPage))
#end
#end
#if($assetList.size()&gt;0)
#addli($startDoc true "")
#else
#addli($startDoc false "")
#end
#if($assetList.size()&gt;0)
&lt;ul&gt;
#foreach($assetPage in $assetList)
#if($assetPage!="")
#set($assetDoc = $xwiki.getDocument($assetPage))
#set($ok = $assetDoc.use("XWiki.TextAssetClass"))
#set($type = "")
#set($type = $assetDoc.getValue("type"))
#if("$type"!="2")
#findCurrikiTitle($assetDoc)
#set($objs2 = $assetDoc.getObjects("XWiki.SubAssetClass"))
#set($assetList2 = $xwiki.arrayList)
#foreach($obj2 in $objs2)
#set($ok = $assetList2.add(""))
#end 
#foreach($obj2 in $objs2)
#set($ok = $assetDoc.use($obj2))
#set($position2 = $assetDoc.getValue("order"))
#set($assetPage2 = $assetDoc.getValue("assetpage"))
#if($position2 &gt;= $assetList2.size())
#set($ok = $assetList2.add($assetPage2))
#else
#set($ok = $assetList2.set($position2.intValue(), $assetPage2))
#end ## end if position
#end ## end foreach
#if($assetList2.size()&gt;0)
#addli($assetDoc true ";$startDoc.fullName")
#else
#addli($assetDoc false ";$startDoc.fullName")
#end ## end addli
#if($assetList2.size()&gt;0)
&lt;ul&gt;
#foreach($assetPage2 in $assetList2)
#if($assetPage2!="")
#set($assetDoc2 = $xwiki.getDocument($assetPage2))
#set($ok = $assetDoc2.use("XWiki.TextAssetClass"))
#set($type2 = "")
#set($type2 = $assetDoc2.getValue("type"))
#if("$type2"!="2")
#findCurrikiTitle($assetDoc2)
#addli($assetDoc2 false ";${startDoc.fullName};${assetDoc.fullName}")
&lt;/li&gt;
#end ## end checktype level 2
#end
#end ##end foreach
&lt;/ul&gt;
#end ## end ul
&lt;/li&gt;
#end ## end checktype level 1
#end
#end ## end foreach
&lt;/ul&gt;
&lt;/li&gt;
#end
&lt;/ul&gt;
&lt;/div&gt;
&lt;br /&gt;
#panelfooter()
#end
{/pre}</content>
</property>
<property>
<description>Asset Table of Contents</description>
</property>
<property>
<name>TOC</name>
</property>
<property>
<type>view</type>
</property>
</object>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>Panels.TOC</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>#includeForm("Panels.PanelSheet")</content>
</xwikidoc>
