<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>Groups</web>
<name>EditMastheadSheet</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.cristi</creator>
<author>XWiki.LudovicDubost</author>
<customClass></customClass>
<contentAuthor>XWiki.LudovicDubost</contentAuthor>
<creationDate>1198091147000</creationDate>
<date>1200584259000</date>
<contentUpdateDate>1200584259000</contentUpdateDate>
<version>1.95</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>Groups.EditMastheadSheet</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>#includeMacros("Groups.Macros")
##Loading spacemanager
#set($sm = $xwiki.csm)
#set($spaceName = $doc.space)
#set($s = $sm.getSpace($spaceName))
#if($request.method=="POST")
  #set($filename = $xwiki.fileupload.getFileName("filepath"))
  #set($ok = $sm.updateSpaceFromRequest($s))
#end
#if($ok)
  #if($filename&amp;&amp;($filename!=""))
    $xwiki.getDocument("${doc.space}.WebHome").addAttachments()
    #set($filename = $context.addedAttachments.get(0).filename)
    $s.set("logo", $filename)
  #end
  $s.save() 
  $response.sendRedirect($s.getHomeURL())
#else
&lt;div class="frame"&gt;
&lt;form class="CreateNewGroup" action="#" enctype="multipart/form-data" method="post" onsubmit="if (!checkFileExtension()) return false; else return true;"&gt;
&lt;input type="hidden" name="action" value="editmasthead" /&gt;
#mycurrikititlebar($msg.get("groups_home_editmasthead_title"), "", "", "blue")
&lt;div class="frame-content"&gt;
&lt;div class="section"&gt;
&lt;br /&gt;
$s.display("displayTitle","edit")
#tooltip("group-title" $msg.groups_home_editmasthead_groupname_tooltip)

#validateGroup( "title-exists" "" $msg.groups_validation_title_exists)    
#validateGroup( "title-short" "" $msg.groups_validation_title_short)    
#validateGroup("title-long"  "" $msg.groups_validation_title_long)
#validateGroup("title-invalid"  "" $msg.groups_validation_title_invalid)
#validateGroup( "space-exists" "" $msg.groups_validation_space_exists)
&lt;div id="form-info-top"&gt;
$s.display("description","edit")
#tooltip("group-description" $msg.groups_home_editmasthead_groupdescription_tooltip)
&lt;/div&gt;

#validateGroup( "desc-short" "" $msg.groups_validation_desc_short)  
#validateGroup( "desc-long" "" $msg.groups_validation_desc_long)
&lt;/div&gt;
#set($logofilename = $xwiki.getDocument("${doc.space}.WebPreferences").display("logo"))
#set($logoattach = $doc.getAttachment($logofilename))
#if(!$logoattach)
#set($logofilename = "")
#end
&lt;div class="section"&gt;
&lt;div class="frame-inset-logo"&gt;
#groupLogo($s)
&lt;/div&gt;
&lt;div class="frame-inset-description"&gt;
#if($logofilename&amp;&amp;$logoattach)
#set($redirect = $xwiki.requestURL)
#set($url = $doc.getAttachmentURL($logofilename, "delattachment", "xredirect=${redirect}"))
$msg.get("groups_home_editmasthead_logo_infotxt_withlogo", [$url])
#else
$msg.groups_home_editmasthead_logo_infotxt_withoutlogo
#end
&lt;/div&gt;
&lt;/div&gt; ## end section
&lt;div class="section"&gt;
&lt;input id="xwikiuploadname" type="hidden" name="filename" value="" /&gt;
&lt;div&gt;&lt;input id="xwikiuploadfile" type="file" name="filepath" value="" size="40"/&gt;&lt;/div&gt;
&lt;/div&gt;
{pre}
&lt;script type="text/javascript"&gt;
function checkFileExtension() {
  var isValid = true;
  var ext = getFileExtension();
  if (ext) {
    if (ext != "ok" &amp;&amp; ext != "ai" &amp;&amp; ext != "gif" &amp;&amp; ext != "jpg" &amp;&amp; ext != "tif" &amp;&amp; ext != "bmp" &amp;&amp; ext != "jpe" &amp;&amp; ext != "psd" &amp;&amp; ext != "png") {
      isValid = false;
    }
  } else {
    isValid = false;
  }
  if (!isValid) {
    alert("$msg.get("mycurriki.profile.needPicture")");
  }
  return isValid;
}
function getFileExtension() {
  var fileName = document.getElementById("xwikiuploadfile").value; 
  if (fileName.length){
   fileName = fileName.toLowerCase();
   var pos = fileName.lastIndexOf(".");
   if (pos &gt; 0){
     return fileName.substring(pos + 1);
   }
  } 
  return "ok";
}
&lt;/script&gt;
{/pre}
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="button-center button-masthead"&gt;&lt;input class="button button-orange" type="submit" value="$msg.groups_home_editmasthead_submit_btt" /&gt;#button(  "$msg.groups_home_editinformation_cancel_btt"  "grey"  "reset"  ""  "if(confirm('$msg.groups_home_editmasthead_cancel_confirm')) window.location='$s.getHomeURL()';" )&lt;/div&gt;
&lt;/form&gt;
#end
&lt;div class="tooltips"&gt;
$xwiki.addTooltipJS()
&lt;/div&gt;</content>
</xwikidoc>
