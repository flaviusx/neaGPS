<?xml version="1.0" encoding="utf-8"?>

<xwikidoc>
<web>FileCheck</web>
<name>WebHome</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent></parent>
<creator>XWiki.LudovicDubost</creator>
<author>XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>XWiki.Admin</contentAuthor>
<creationDate>1194209149000</creationDate>
<date>1221603695000</date>
<contentUpdateDate>1221603695000</contentUpdateDate>
<version>58.1</version>
<title></title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment>persist BFCS filter criteria</comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/1.0</syntaxId>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>FileCheck.WebHome</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>##----------------Indicate if order ascending or descending
#if($request.directionOrder)
	#if($request.directionOrder=="asc" &amp;&amp; $request.previousOrderColumn &amp;&amp; $request.previousOrderColumn==$request.order)
               entro1
		#set($directionOrder="desc")
	#else
               entro2
		#set($directionOrder="asc")
	#end
	#set($currentDirectionOrder=$directionOrder)
#else
        #if($request.currentDirectionOrder &amp;&amp; $request.order==$previousOrderColumn)
                #set($currentDirectionOrder=$request.currentDirectionOrder)
        #else
                #set($currentDirectionOrder="asc")
        #end
#end

#set($previousOrderColumn=$request.order)

1 $msg.fc_filecheck
#set($excludeList = ["jmarks", "LudovicDubost", "rmlucas", "RoadofLife", "BobandGeorge", "jkl1231", "Templates", "curriki", "demo", "Entrepreneurship1", "PopTech", "NROCscience", "NROCMath", "Athabasca", "mopsyhop", "ShermanTank", "TravelsWithMusic", "Panwapa", "ALTEC", "Wyoming", "nextvista", "Norteltest", "NortelLearniTTwentyFirstCenturyeLearning", "LearniT", "TestingTodd", "cybersmart", "smarthinkingMath", "dward", "GBelvins", "msutro", "HeyMath", "passandr", "noahk", "katprince", "bobbi", "aschreiber", "rdang", "driscoll"])
#set($startIndex = 0)
#if($request.startIndex)
	#set($startIndex = $xwiki.parseInt($request.startIndex))
#end
#set($itemsPerPage = 20)
#if( $request.ipp )
	#set($itemsPerPage = $xwiki.parseInt($request.ipp))
#end


##----------------Begin Get filters from cookies
#set($assetFilterCreationDateFrom = $request.getCookie("assetFilterCreationDateFrom"))
#if($assetFilterCreationDateFrom)
	#set($assetFilterCreationDateFrom = $assetFilterCreationDateFrom.getValue())
#end
#set($assetFilterCreationDateTo = $request.getCookie("assetFilterCreationDateTo"))
#if($assetFilterCreationDateTo)
	#set($assetFilterCreationDateTo = $assetFilterCreationDateTo.getValue())
#end

#set($assetFilterFileCheckStatus = $request.getCookie("assetFilterFileCheckStatus"))
#if($assetFilterFileCheckStatus)
	#set($assetFilterFileCheckStatus = $assetFilterFileCheckStatus.getValue())
#end

#set($assetFilterSubjectArea = $request.getCookie("assetFilterSubjectArea"))
#if($assetFilterSubjectArea)
	#set($assetFilterSubjectArea = $assetFilterSubjectArea.getValue())
#end


##----------------End Get filters from cookies

#set($qs = "type=$!assetFilterFileCheckStatus")
#set($counter = 0)
#set($fromsql = "")
#set($wheresql = "and doc.creator not in (")
#foreach($user in $excludeList)
	#if($velocityCount&gt;1)
		#set($wheresql = "$wheresql ,")
	#end
	#set($wheresql = "$wheresql 'XWiki.${user}'")
#end
#set($wheresql = "$wheresql )")
#set($wheresql = "$wheresql and doc.fullName not in (select obj3.name from BaseObject as obj3, LongProperty as lprop3 where obj3.className='XWiki.TextAssetClass' and obj3.id=lprop3.id.id and lprop3.id.name='type' and lprop3.value=2)")


#if($assetFilterCreationDateFrom&amp;&amp;($assetFilterCreationDateFrom!="")&amp;&amp;($assetFilterCreationDateFrom!="YYYY/MM/DD"))
	#set($wheresql = "$wheresql and doc.creationDate&gt;'$assetFilterCreationDateFrom'")
	#set($from = $assetFilterCreationDateFrom)
	#set($qs = "${qs}&amp;from=$!$assetFilterCreationDateFrom")
	#else
		#set($from = "YYYY/MM/DD")
#end

#if($assetFilterCreationDateTo&amp;&amp;($assetFilterCreationDateTo!=""))
	#set($wheresql = "$wheresql and doc.creationDate&lt;'$assetFilterCreationDateTo'")
	#set($to = $assetFilterCreationDateTo)
	#set($qs = "${qs}&amp;to=$!$assetFilterCreationDateTo")
	#else
	 	#set($to = "")
#end

#if($assetFilterFileCheckStatus=="1")##without status
	#set($wheresql = "$wheresql and obj.id not in (select obj2.id from BaseObject as obj2, StringProperty as sprop2 where obj2.className='XWiki.AssetClass' and obj2.id=sprop2.id.id and sprop2.id.name='fcstatus' and sprop2.value is not null)")
	#elseif($assetFilterFileCheckStatus!="1" &amp;&amp; $assetFilterFileCheckStatus!="0")##with status
		#set($fromsql = "$fromsql ,StringProperty as sprop")
		#set($wheresql = "$wheresql and obj.id=sprop.id.id and sprop.id.name='fcstatus' and sprop.value is not null ")
			#if($assetFilterFileCheckStatus=="2")##with any status
				#set($wheresql = "$wheresql and sprop.value &lt;&gt; '0'")
			#end
			#if($assetFilterFileCheckStatus=="3")##with status ok
				#set($wheresql = "$wheresql and sprop.value = '1'")
			#end
			#if($assetFilterFileCheckStatus=="4")##with status Special Check Required
				#set($wheresql = "$wheresql and sprop.value = '2'")
			#end
			#if($assetFilterFileCheckStatus=="5")##with status Improvement Requested
				#set($wheresql = "$wheresql and sprop.value = '3'")
			#end
			#if($assetFilterFileCheckStatus=="6")##with status Deleted
				#set($wheresql = "$wheresql and sprop.value = '4'")
			#end

#end

#if($request.order=="fcstatus")
	#if($assetFilterFileCheckStatus!="2")
		#set($fromsql = "$fromsql ,StringProperty as sprop")
		#set($wheresql = "$wheresql and obj.id=sprop.id.id and sprop.id.name='fcstatus'")
	#end
	#set($order = "sprop.value $currentDirectionOrder")
	#elseif($request.order=="fcdate")
		#set($fromsql = "$fromsql ,DateProperty as dprop")
		#set($wheresql = "$wheresql and obj.id=dprop.id.id and dprop.id.name='fcdate'")
		#set($order = "dprop.value $currentDirectionOrder")
		#elseif($request.order=="contributor")
			#set($fromsql = "$fromsql ,BaseObject as userObj,StringProperty as userSprop")
			#set($wheresql = "$wheresql and doc.creator=userObj.name and userObj.className='XWiki.XWikiUsers' and userObj.id=userSprop.id.id and userSprop.id.name='first_name'")
			#set($order = "userSprop.value $currentDirectionOrder")
			#elseif($request.order=="resourcetitle")
				#set($fromsql = "$fromsql ,StringProperty as dprop")
				#set($wheresql = "$wheresql and obj.id=dprop.id.id and dprop.id.name='title'")
				#set($order = "dprop.value $currentDirectionOrder")
			#else
				#set($order = "doc.creationDate desc")
#end

## Check which Subject was selected in the filter combo
#if(($assetFilterSubjectArea)&amp;&amp;($assetFilterSubjectArea!=""))
	#set($fromsql = "$fromsql ,DBStringListProperty as prop2 join prop2.list list ")
	#set($wheresql = "$wheresql  and obj.id=prop2.id.id and prop2.id.name='fw_items' and list = '${assetFilterSubjectArea}'")
#end

## Filter for excluding Favorites Collections
#set($notFavoritesFoldersSQL = " and doc.fullName not like 'Coll_%.Favorites' ")

#set($sql = ", BaseObject as obj $!fromsql where doc.web like 'Coll_%' and doc.fullName=obj.name and obj.className='XWiki.AssetClass' $!notFavoritesFoldersSQL $!wheresql order by $order")
#set($countsql = "select count(*) from XWikiDocument as doc ${sql}")
#set($auxTotalCount = $xwiki.search($countsql))
#set($totalCount = 0)
#if($auxTotalCount.size()&gt;=0)
	#set($totalCount = $auxTotalCount.get(0))
#end
&lt;!-- $sql --&gt;
	{pre}
	 &lt;script type="text/javascript"&gt;
	 			function saveFilterParameters(form) {
	 				var fromText=document.getElementById('from');
	 				createCookie("assetFilterCreationDateFrom",fromText.value, "");
	 				var toText=document.getElementById('to');
	 				createCookie("assetFilterCreationDateTo",toText.value, "");
	 				var fileCheckStatusSelect=document.getElementById('type');
	 				createCookie("assetFilterFileCheckStatus",fileCheckStatusSelect.value, "");
	 				var subjectAreaSelect=document.getElementById('fw_item');
	 				createCookie("assetFilterSubjectArea",subjectAreaSelect.value, "");
					return true;
				}
	&lt;/script&gt;
	{/pre}
&lt;form action="" onsubmit="return saveFilterParameters(this);"&gt;
	1.1 $msg.fc_daterange
	$msg.fc_showresourcesfrom &lt;input type="text" style="width: auto;" id="from" name="from" value="$!from" size="12" /&gt;
	$msg.fc_to &lt;input type="text" style="width: auto;" id="to" name="to" value="$!to" size="12" /&gt;
	1.1 $msg.fc_filterby

	$msg.fc_queueFilterChooseFCStatus

	&lt;select name="type" id="type"&gt;
			&lt;option value="0" #if(!$assetFilterFileCheckStatus||($assetFilterFileCheckStatus=="0")) selected #end &gt;$msg.get("fc_all")&lt;/option&gt;
			&lt;option value="1" #if($assetFilterFileCheckStatus=="1") selected #end &gt;$msg.get("fc_onlywithoutfcstatus")&lt;/option&gt;
			&lt;option value="2" #if($assetFilterFileCheckStatus=="2")) selected #end &gt;$msg.get("fc_onlywithfcstatus")&lt;/option&gt;
			#foreach($status in [1..4])
				#set($auxStatus = $status+2)
				&lt;option value="$auxStatus" #if($auxStatus=="$assetFilterFileCheckStatus")  selected #end &gt;$msg.get("fc_statusFilter_${status}")&lt;/option&gt;
			#end
	&lt;/select&gt;

	&lt;br /&gt;

	$msg.fc_queueFilterChooseSubjectArea

	&lt;select name="fw_item" id="fw_item"&gt;
			&lt;option value="" #if(!$assetFilterSubjectArea||($assetFilterSubjectArea=="")) selected #end &gt;$msg.get("fc_all")&lt;/option&gt;
        #foreach($item in $xwiki.searchDocuments("where doc.parent='FW_masterFramework.WebHome'"))
        #set($itemdoc = $xwiki.getDocument($item))
    		&lt;option value="$item" #if($item==$assetFilterSubjectArea) selected #end &gt;$itemdoc.title&lt;/option&gt;
        #end
	&lt;/select&gt;

	&lt;input type="submit" value="$msg.fc_ok" /&gt;

&lt;/form&gt;

&lt;table class="filechecktable" style="table-layout:fixed;width:100%;overflow:hidden;word-wrap:break-word;"&gt;
	&lt;tr&gt;
&lt;th&gt; [$msg.fc_resourcetitle&gt;$doc.fullName?$qs&amp;order=resourcetitle&amp;directionOrder=$currentDirectionOrder&amp;previousOrderColumn=$previousOrderColumn]&lt;/td&gt;
		&lt;th&gt; $msg.fc_dateadded &lt;/td&gt;
		&lt;th&gt; $msg.fc_queueTableColheaderIct &lt;/td&gt;
&lt;th&gt; [$msg.fc_contributor&gt;$doc.fullName?$qs&amp;order=contributor&amp;directionOrder=$currentDirectionOrder&amp;previousOrderColumn=$previousOrderColumn]&lt;/td&gt;
		&lt;th&gt; [$msg.fc_status&gt;$doc.fullName?$qs&amp;order=fcstatus&amp;directionOrder=$currentDirectionOrder&amp;previousOrderColumn=$previousOrderColumn] &lt;/td&gt;
		&lt;th&gt; [$msg.fc_datechecked&gt;$doc.fullName?$qs&amp;order=fcdate&amp;directionOrder=$currentDirectionOrder&amp;previousOrderColumn=$previousOrderColumn] &lt;/td&gt;
		&lt;th&gt; $msg.fc_notes &lt;/td&gt;
		&lt;th&gt; $msg.fc_select &lt;/td&gt;
	&lt;/tr&gt;
	#foreach($fullname in $xwiki.searchDocuments($sql,$itemsPerPage,$startIndex))
		#set($counter = $counter+1)
		#set($itemdoc = $xwiki.getDocument($fullname))
		#set($ok = $itemdoc.use("XWiki.AssetClass"))
		#findCurrikiTitle($itemdoc)
		&lt;tr&gt;
			&lt;td&gt;
				&lt;div class="title"&gt;
					&lt;a href="$xwiki.getURL($fullname, "view")" target="_blank" /&gt;
					$currikiTitle&lt;/a&gt;
				&lt;/div&gt;
			&lt;/td&gt;
            &lt;td&gt;
            	&lt;div class="date"&gt;
            		$itemdoc.creationDate
            	&lt;/div&gt;
            &lt;/td&gt;
			&lt;td&gt;
            	&lt;div class="ict"&gt;
            		#set($ict = $xwiki.curriki.getAssetICT($fullname))
					#if($ict.size()==1)
						$ict.get(0)
						#elseif($ict.size()&gt;1)
							$msg.fc_queueTableICTMultiple
					#end
            	&lt;/div&gt;
            &lt;/td&gt;
            &lt;td&gt;
            	&lt;div class="username"&gt;
            		$xwiki.getLocalUserName($itemdoc.creator)
            	&lt;/div&gt;
            &lt;/td&gt;
            &lt;td&gt;
            	&lt;div class="fcstatus"&gt;
            		$itemdoc.display("fcstatus")
            	&lt;/div&gt;
            &lt;/td&gt;
            &lt;td&gt;
            	&lt;div class="fcdate"&gt;
            		$itemdoc.display("fcdate")
            	&lt;/div&gt;
            &lt;/td&gt;
            &lt;td&gt;
            	&lt;div class="fcnotes"&gt;
            		$itemdoc.display("fcnotes")
            	&lt;/div&gt;
            &lt;/td&gt;
            &lt;td&gt;
            	&lt;div class="action"&gt;
            		#set($qs2 = $xwiki.getURLEncoded($fullname))
            		&lt;a href="$xwiki.getURL("FileCheck.Check", "view", "page=${qs2}")" target="_blank" /&gt;
            		${msg.fc_action}&lt;/a&gt;
            &lt;/div&gt;
            &lt;/td&gt;
		&lt;/tr&gt;
	#end
&lt;/table&gt;
#if($request.order)
	#set($qs = "${qs}&amp;order=${request.order}&amp;directionOrder=${request.currentDirectionOrder}")
#end

#mycurriki_paginatorargs($msg.fc_files, $startIndex, $itemsPerPage, $totalCount, $qs)</content>
</xwikidoc>
