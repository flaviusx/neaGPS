<?xml version="1.0" encoding="UTF-8"?>

<xwikidoc>
<web>MyCurriki</web>
<name>Blog</name>
<language></language>
<defaultLanguage>en</defaultLanguage>
<translation>0</translation>
<parent>MyCurriki.WebHome</parent>
<creator>XWiki.ShermanTank</creator>
<author>XWiki.dward</author>
<customClass></customClass>
<contentAuthor>XWiki.dward</contentAuthor>
<creationDate>1202337483000</creationDate>
<date>1203117041000</date>
<contentUpdateDate>1203117041000</contentUpdateDate>
<version>1.2</version>
<title>Blog</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<object>
<class>
<name>XWiki.TagClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<tags>
<cache>0</cache>
<displayType>select</displayType>
<multiSelect>1</multiSelect>
<name>tags</name>
<number>1</number>
<prettyName>Tags</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>30</size>
<unmodifiable>0</unmodifiable>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</tags>
</class>
<name>MyCurriki.Blog</name>
<number>0</number>
<className>XWiki.TagClass</className>
<property>
<tags/>
</property>
</object>
<content>#includeMacros("MyCurriki.MyCurrikiMacros")
## content macro
#macro(mycurrikipage_content $userdoc $userobj)
#mycurrikititlebar($msg.get("mycurriki.blog.titlebar") "" "" "blue")
#set($shortname = $userdoc.fullName)
#if($shortname.startsWith("XWiki."))
 #set($shortname = $shortname.substring(6))
#end
## #mycurrikiavatarwithname($userdoc)
##
#set($hasBlog=$xwiki.exists("Blog_${shortname}.WebHome"))
#if(!$hasBlog) ## {
&lt;div&gt;
$msg.get("mycurriki.blog.noblog")
&lt;/div&gt;
#else ## } {
##
#set($category = "$!request.category")
#set($nbitems = "10")
#set($nbstart = $request.nbstart)
#set($space = "Blog_${shortname}")
#if(!$itemname)
 #set($itemname = "Blog")
#end
#set($next = $msg.get("myBlog.nextArticle"))
#set($prev = $msg.get("myBlog.previousArticle"))
#set($readnext = $msg.get("myBlog.continueReading"))
#set($addanews = $msg.get("myBlogs.addArticle"))
#set($addanewsdetails = $msg.get("myBlogs.addArticle.details"))
#set($newstitle = $msg.get("myBlogs.articleTitle"))
#macro(blog $category $nbitems $nbstart)
#set($spacesql = " and doc.web='${space}'")
#if($category=='')
#set ($sql = ", BaseObject as obj where obj.name=doc.fullName and obj.className='XWiki.ArticleClass' and doc.name&lt;&gt;'ArticleClassTemplate' $spacesql order by doc.creationDate desc")
#else
#set ($sql = ", BaseObject as obj, DBStringListProperty as cat join cat.list list where obj.name=doc.fullName and obj.className='XWiki.ArticleClass' and doc.name&lt;&gt;'ArticleClassTemplate' $spacesql and obj.id=cat.id.id and cat.id.name='category' and list='$category' order by doc.creationDate desc")
#end
#set($cdate = "")
#set($inbitems = $xwiki.parseInt($nbitems))
#set($inbstart = $xwiki.parseInt($nbstart))
#set($counter = 0)
#foreach ($item in $xwiki.searchDocuments($sql, $inbitems, $inbstart))
#if ($counter != 0)
 &lt;hr /&gt;
#end
&lt;div class="cd-article"&gt;
#set($counter = $counter+1)
#set($bentrydoc = $xwiki.getDocument($item))
#set($bentryobj = $bentrydoc.getObject("XWiki.ArticleClass"))
#set($creationDate = $xwiki.formatDate($bentrydoc.creationDate,$msg.get("mycurriki.datetimeFormat")))
#displayMyCurrikiBlogArticle($bentrydoc, $bentryobj, false)
&lt;br/&gt;
#if($counter==$inbitems)
&lt;div style="float: right; margin-right: 30px"&gt;
#if ($inbstart!=0)
#set($iprev = $inbstart - $inbitems)
[$prev&gt;$doc.name?nbstart=${iprev}]
#end
#set($inext = $inbstart + $inbitems)
[$next&gt;$doc.name?nbstart=${inext}]
&lt;/div&gt;
#end
&lt;/div&gt;
#end
#end

#blog($category $nbitems $nbstart)
#end ## }
#end ## content macro
##
##
## Create button
#macro(mycurrikipage_button $userobj)
#if($context.action == "view" &amp;&amp; ($context.user==$userdoc.fullName || $xwiki.hasAdminRights()))
#set($shortname = $userdoc.fullName)
#if($shortname.startsWith("XWiki."))
 #set($shortname = $shortname.substring(6))
#end
#set($hasBlog=$xwiki.exists("Blog_${shortname}.WebHome"))
#if(!$hasBlog) ## {
&lt;a class="button button-orange" href="$xwiki.getURL("Members.MyBlog", "view", "xredirect=$xwiki.requestURL")" title="$msg.get("mycurriki.blog.createBlog")"&gt;$msg.get("mycurriki.blog.createBlog")&lt;/a&gt;
#else ## } {
&lt;a class="button button-orange" href="$xwiki.getURL("XWiki.CreateArticle", "view", "space=Blog_${shortname}&amp;xredirect=$xwiki.requestURL")" title="$msg.get("mycurriki.blog.createEntry")"&gt;$msg.get("mycurriki.blog.createEntry")&lt;/a&gt;
#end ## }
#end
#end ## button macro
## END OF MACROS
## END OF SETTINGS
## Display of page
#mycurrikipagewithbutton("blog")</content>
</xwikidoc>
