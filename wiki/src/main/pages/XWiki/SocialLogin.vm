#* @vtlvariable name="doc" type="com.xpn.xwiki.api.Document" *#
## @vtlvariable name="asset" type="org.curriki.xwiki.plugin.asset.Asset"
## @vtlvariable name="document" type="com.xpn.xwiki.api.Document"
#* @vtlvariable name="xwiki" type="com.xpn.xwiki.api.XWiki" *# ##
#* @vtlvariable name="util" type="com.xpn.xwiki.api.Util" *# ##
#* @vtlvariable name="request" type="javax.servlet.http.HttpServletRequest" *# ##
#* @vtlvariable name="context" type="com.xpn.xwiki.api.Context" *# ##
#* @vtlvariable name="msg" type="com.xpn.xwiki.web.XWikiMessageTool" *# ##
#set($tool=$xwiki.parseGroovyFromPage("XWiki.SocialLoginToolGroovy"))##
$tool.init($xwiki,$context,$request,$response,$msg)##
#set($view=$tool.action())##
#macro(render)
    #if($view=="creationForm")$xwiki.includeForm("XWiki.RegistrationBootstrap",false)##
    #set($view="nothing")
    #elseif($view=="bounceToProvider")#set($view=$tool.bounceToProvider())
    #elseif($view=="processAuthReturn")#set($view=$tool.processAuthReturn())
    #elseif($view=="createNewProfile")#set($view=$tool.tryCreateNewProfile())
    #elseif($view=="loginSucceeded")#set($view=$tool.acceptLoginAndRedirect())
    #elseif($view=="redirectInHtml")## rather JS-redirect so that we get frame=_top and a wait dialog
<html><head><title>Redirection</title></head><body>##
#set($targetUrl=${tool.getRedirectTarget()})
<a href="$targetUrl" target="_top">follow me</a>##
<script type="text/javascript">window.top.location.href = "$targetUrl";</script>##
</body></html>##
    #elseif($view=="error")#foreach($e in $tool.errors)#error($e)#end
    #elseif($view=="nothing")##nothing
    #else<!-- ${msg.get('xwiki.socialLogin.nothingToDo')} -->
    #end##
#end##
<!-- view is $view -->
#render()##
## the little extra in case
<!-- view is $view -->
#if($view)#render()#end##
<!-- view is $view -->
#if($view)#render()#end##
