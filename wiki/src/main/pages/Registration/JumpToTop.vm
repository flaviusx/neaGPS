##
## This page is included by other pages when a delivery on top
## of the useful windows is needed instead of a framed or popped-up one.
##
## it needs one variable or parameter to be defined: redir
{pre}#if($redir)#else#set($redir=$request.redir)#end##
#if($redir)#else#set($redir=$targets.afterLogin)#end##
#if($redir)#else#set($redir="/")#end##
#if($redir.contains("Registration/JumpToTop"))#set($redir="/")#end
<html><head><title>Redirection</title></head><body>##
<p style="width:100%; height:100%; text-align: center; line-height:10em; background-color: #d3d3d3;"
        ><a id="followMeLink" href="${redir}" target="_top">$msg.get("registration.jump.proceeding")</a>##
    ##<img src="/xwiki/skins/curriki8/icons/spinner.gif"/>
        </p>##
<script type="text/javascript">##
    var w = window;
    try {
        if (w.name == 'curriki-identity-dialog-popup'
                && w.opener && w.opener.name == 'curriki-identity-dialog') {
            w = window.opener;
            if (!(w.name)) w.name = "curriki-parent-window";
            window.links[0].target = w.name;
        }
    } catch(e) {
        if(console) console.log("Can't check for parent.",e);
    }
    w.moveOnTask = null;##
    function moveOn() {##
        window.clearInterval(w.moveOnTask);##
        if(w!=window) // this was a popup, close me in 100ms
            window.setInterval("window.close();", 100);##
        w.top.location.replace("${redir}");
        //alert("Would replace with  ${redir}")
        if(console) console.log("Jumping to ${redir}");##
         w.moveOnTask = null;##
    }##
    w.moveOnTask = window.setInterval(moveOn,50);</script>##
</body></html>##
{/pre}