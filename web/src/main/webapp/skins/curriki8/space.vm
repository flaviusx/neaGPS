
#macro(parentsBreadcrumb $bcDoc $level)

#set($sm = $xwiki.csm)
#set($spaceName = $bcDoc.getSpace())
#set($s = $sm.getSpace($spaceName))
#if( $s ) #if( $s.isNew() || $s.isDeleted() )
  #set( $s = "" )
#end #end

##groups specifics
###group creation page
#if($bcDoc.fullName == "Groups.CreateNewGroup")
  #set($usr = $context.user)
  $xwiki.getUserName($usr,true) &gt;
#end
###group home

#if($!s=="") ## NOT groups specific

#set($parent = $bcDoc.parent) 
#if($parent && ($!parent != "") && ($level < 6) && ($bcLocal.indexOf($parent) == -1))
  #set($bcLocal = "${parent};${bcLocal}")
  #set($level = $level + 1)
  #parentsBreadcrumb($xwiki.getDocument($parent) $level)
#else
  #set($hql = "select obj from BaseObject as obj, StringProperty as props where obj.id=props.id.id and obj.className='XWiki.SubAssetClass' and props.id.name='assetpage' and props.value='${bcDoc.fullName}'")
  #foreach($bcItem in $xwiki.search($hql, 1, 0))
   #set($bcLocal = "${bcItem.name};${bcLocal}")
   #set($level = $level + 1)
   #parentsBreadcrumb($xwiki.getDocument(${bcItem.name}) $level)
  #end
#end

#if($bcDoc.space.startsWith("Documentation_")) ## documentation space
  #set($grName = $bcDoc.space.substring( 14 ))
  #set($s = $sm.getSpace($grName))
  #if( $s )
    #if( $s.isNew() || $s.isDeleted() )
      #set( $s = "" )
    #end
  #end
  #if($!s=="") #else
  		  <a href="$s.getHomeURL()">$s.getDisplayTitle()</a> &gt; ##groups name 
  		  #set($docPageName = $grName+".Documentation") 
  		  #set($docPage = $xwiki.getDocument( $docPageName ) ) 
  		  <a href="$docPage.getURL()">${docPage.displayTitle}</a> &gt; ##documentation page
  #end  
#end ## end of documentation space
  
#else ##GROUP SPECIFIC
  <a href="$s.getHomeURL()">$s.getDisplayTitle()</a> &gt;
 
  #if($bcDoc.name == "Contributions" || $bcDoc.name == "ContributionsSearch")
    <a href="${s.getHomeURL()}Curriculum">$msg.get("groups_curriculum_tabname")</a> &gt;
  #end

#end  ## end group specifics

#end ## end macro
##
##
##
##
#macro(currikiBreadcrumb $bcParam $bcCurrentDoc)

#set($sm = $xwiki.csm)
#set($spaceName = $bcCurrentDoc.getSpace())
#set($s = $sm.getSpace($spaceName))
#if( $s ) #if( $s.isNew() || $s.isDeleted() )
  #set( $s = "" )
#end #end

 ##Preparation de la liste
 #set($bcParent = $bcParam)
 #if($bcParam && $!bcParam != "")
  #if($bcParam.endsWith($doc.fullName))
   #set($bcLocal = $bcParam)
  #else
   #set($bcLocal = "${bcParam};${doc.fullName}")
  #end
 #else
  #set($bcLocal = $doc.fullName)
 #end
 #if(!$bcParam || $!bcParam == "")
  #parentsBreadcrumb($bcCurrentDoc, 0)
 #end
 ##Deroulage de la liste
 #set($isFirst = true)
 #set($previousBc = "")
 #foreach($bcItem in $bcLocal.split(";"))
  #if($bcItem != "" && $bcItem != "XWiki.XWikiUsers")
   
   #if(!$isFirst)
    &gt; 
   #end

   #set($isFirst = false)
   #set($bcDoc = $xwiki.getDocument($bcItem.replace('/', '.')))
   
   #if($bcDoc.fullName == "XWiki.EditArticle" && $request.editArticle)
    #set($bcDoc = $xwiki.getDocument($request.editArticle))
   #end

   #findCurrikiTitle($bcDoc)

   ##groups specific rules
   #if($!s=="") 
     ##don't fix anything
   #else
     #if($bcDoc.name==$msg.groups_home_page) ##home page
       #set($currikiTitle = $msg.groups_home_tabname)
       #if($request.action)
         #if($request.action=="editmasthead")
           #set($currikiTitle = $currikiTitle + "</a> &gt; <a href='${bcDoc.getURL()}?action=editmasthead'>${msg.groups_home_editmasthead_bc}</a>")
	         #end
         #if($request.action=="editinfo")
           #set($currikiTitle = $currikiTitle + "</a> &gt; <a href='${bcDoc.getURL()}?action=editinformation'>${msg.groups_home_editinformation_bc}</a>")
         #end
       #end
     #end ##end home page
     #if($bcDoc.name=="Documentation") ##documentation page
     	  #if(	$request.action)
     	  	  #if($request.action == "newdoc")
     	  	  	  #set($currikiTitle = $currikiTitle + "</a> &gt; <a href='${bcDoc.getURL()}?action=newdoc'>${msg.groups_documentation_create_wiki_page_title}</a>")
     	  	  #end
     	  	  #if($request.action == "editdoc")
     	  	  	  #set($currikiTitle = $currikiTitle + "</a> &gt; <a href='${bcDoc.getURL()}?action=newdoc'>${msg.groups_documentation_edit_wiki_title}</a>")
     	  	  #end
     	  	  #if($request.action == "history")
     	  	  	  #set($currikiTitle = $currikiTitle + "</a> &gt; <a href='${bcDoc.getURL()}?action=newdoc'>${msg.groups_documentation_history_title}</a>")
     	  	  #end
     	  	  #if($request.action == "compare")
     	  	  	  #set($currikiTitle = $currikiTitle + "</a> &gt; <a href='${bcDoc.getURL()}?action=newdoc'>${msg.groups_documentation_compare_title}</a>")
     	  	  #end
     	  #end
     #end  ##end documentation page
   ###else
   ##  #if($bcDoc.fullName == "Groups.CreateNewGroup")
   ##    #set($currikiTitle = $msg.get("groups_creategroup_pagename"))
   ##  #end
   #end
   ##end of groups specific rules

   #set($userArg = "")
   #if($bcDoc.space=="MyCurriki" && "$!request.user" != "")
    #set($userArg="&user=$request.user")
   #end

   <a href="$bcDoc.getURL("view", "bc=${previousBc}${userArg}")">$currikiTitle</a>
   #set($previousBc = "${previousBc};${bcItem}")
   
   #set($more = "")
   #if($bcDoc.fullName == "Groups.Browse")
     #if( $request.subject )
		#set($sdoc = $xwiki.getDocument($request.subject))
		#set($more = "${sdoc.title} ${msg.get('browseGroups.groups')}")
		#set($more_href = "${doc.getURL()}?subject=${request.subject}")
     #end
   #end

 
   #if($more != "")
     &gt; <a href="$more_href">$more</a>
   #end
   

  #end
 #end
 
#end
##
##
##
#if($context.getMode()==0) ## Visible only in a page
<div id="headerspace" class="layoutsection">
<div class="minwidth"></div>
<hr/>
  <div id="breadcrumbs">
 #currikiBreadcrumb($request.bc $doc)
  </div>
<hr/>
</div>
#end
