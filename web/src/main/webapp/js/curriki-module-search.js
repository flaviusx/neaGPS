(function(){Ext.ns("Curriki.module.search");var b=Curriki.module.search;b.settings={gridWidth:(Ext.isIE6?620:"auto")};b.stateProvider=new Ext.state.CookieProvider({});Ext.state.Manager.setProvider(b.stateProvider);b.sessionProvider=new Ext.state.CookieProvider({expires:null})})();(function(){Ext.ns("Curriki.module.search.util");var b=Curriki.module.search;var c=b.util;c.init=function(){console.log("search util: init");c.logFilterList={resource:["subject","level","language","ict","review","special","other","sort","dir"],group:["subject","level","language","policy","other","sort","dir"],member:["subject","member_type","country","other","sort","dir"],blog:["other","sort","dir"],curriki:["other","sort","dir"]};c.registerTabTitleListener=function(d){Ext.StoreMgr.lookup("search-store-"+d).addListener("datachanged",function(j){var i=false;var l=0;var k=j.getTotalCount();if(!Ext.isEmpty(j.reader.jsonData)&&!Ext.isEmpty(j.reader.jsonData.totalResults)){l=parseInt(j.reader.jsonData.totalResults)}if(l>k){i=true}var f=Ext.getCmp("search-"+d+"-tab");if(!Ext.isEmpty(f)){var h=_("search.tab.title.results");if(i&&(_("search.tab.title.resultsmax_exceeds")!=="search.tab.title.resultsmax_exceeds")){h=_("search.tab.title.resultsmax_exceeds")}f.setTitle(String.format(h,_("search."+d+".tab.title"),k,l))}var g=Ext.getCmp("search-pager-"+d);if(!Ext.isEmpty(g)){var e=_("search.pagination.afterpage");if(i&&(_("search.pagination.afterpage_resultsmax_exceeds")!=="search.pagination.afterpage_resultsmax_exceeds")){e=_("search.pagination.afterpage_resultsmax_exceeds")}g.afterPageText=String.format(e,"{0}",l);var m=_("search.pagination.displaying."+d);if(i&&(_("search.pagination.displaying."+d+"_resultsmax_exceeds")!=="search.pagination.displaying."+d+"_resultsmax_exceeds")){m=_("search.pagination.displaying."+d+"_resultsmax_exceeds")}g.displayMsg=String.format(m,"{0}","{1}","{2}",l)}});Ext.StoreMgr.lookup("search-store-"+d).addListener("load",function(l,h,n){var g=n.params||{};var f=g.module;var i=escape(g.terms||"");var k=Ext.getCmp("search-advanced-"+f);var m=(k&&!k.collapsed)?"advanced":"simple";var j="";if(g.start){if(g.start!=="0"){j="/start/"+g.start}}var e="";Ext.each(c.logFilterList[f],function(o){if(!Ext.isEmpty(g[o],false)){e+="/"+o+"/"+escape(g[o])}});Curriki.logView("/features/search/"+f+"/"+i+"/"+m+e+j);b.doSearch(f,false,true)})};c.doSearch=function(h,i){console.log("Doing search",h,i);var f={};var e=Ext.getCmp("search-termPanel");if(!Ext.isEmpty(e)){var g=e.getForm();if(!Ext.isEmpty(g)){Ext.apply(f,g.getValues(false));a}}Ext.apply(f,{module:h});e=Ext.getCmp("search-filterPanel-"+h);if(!Ext.isEmpty(e)){var g=e.getForm();if(!Ext.isEmpty(g)){Ext.apply(f,g.getValues(false))}}if(f.terms&&f.terms===_("search.text.entry.label")){f.terms=""}console.log("Applying search filters",f);Ext.apply(Ext.StoreMgr.lookup("search-store-"+h).baseParams||{},f);var d=Ext.getCmp("search-pager-"+h);if(!Ext.isEmpty(d)){console.log("Searching",f);d.doLoad(Ext.num(i,0))}console.log("Done util.doSearch",f)};c.createTermPanel=function(e,d){return{xtype:"panel",labelAlign:"left",id:"search-termPanel-"+e,cls:"term-panel",border:false,items:[{layout:"column",border:false,defaults:{border:false},items:[{layout:"form",id:"search-termPanel-"+e+"-form",cls:"search-termPanel-form",items:[{xtype:"textfield",id:"search-termPanel-"+e+"-terms",cls:"search-termPanel-terms",fieldLabel:_("search.text.entry.label"),name:"terms",hideLabel:true,emptyText:_("search.text.entry.label"),listeners:{specialkey:{fn:function(g,f){if(f.getKey()===Ext.EventObject.ENTER){f.stopEvent();b.doSearch(e,true)}}}}}]},{layout:"form",id:"search-termPanel-buttonColumn-"+e,cls:"search-termPanel-buttonColumn",items:[{xtype:"button",id:"search-termPanel-button-"+e,cls:"search-termPanel-button",text:_("search.text.entry.button"),listeners:{click:{fn:function(){b.doSearch(e,true)}}}}]},{xtype:"box",id:"search-termPanel-tips-"+e,cls:"search-termPanel-tips",autoEl:{html:'<a href="/xwiki/bin/view/Search/Tips?xpage=popup" target="search_tips" onclick="{var popup=window.open(this.href, \'search_tips\', \'width=725,height=400,status=no,toolbar=no,menubar=no,location=no,resizable=yes\'); popup.focus();} return false;">'+_("search.text.entry.help.button")+"</a>"}}]},{xtype:"hidden",name:"other",id:"search-termPanel-other-"+e,value:(!Ext.isEmpty(b.restrictions)?b.restrictions:"")}]}};c.fieldsetPanelSave=function(d,e){if(Ext.isEmpty(e)){e={}}if(!d.collapsed){e.collapsed=d.collapsed}else{e=null}console.log("fieldset Panel Save state:",e);b.sessionProvider.set(d.stateId||d.id,e)};c.fieldsetPanelRestore=function(d,e){if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.collapsed)&&!e.collapsed){d.expand(false)}};c.registerSearchLogging=function(d){}};Ext.onReady(function(){c.init()})})();(function(){var c="resource";Ext.ns("Curriki.module.search.data."+c);var b=Curriki.module.search.data.resource;b.init=function(){console.log("data."+c+": init");b.filter={};var d=b.filter;d.data={};d.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.UNSPECIFIED")]]};d.data.subject.mapping.each(function(e){d.data.subject.list.push(e.id)});d.data.subject.list.push("UNCATEGORIZED");d.data.subject.list.each(function(e){d.data.subject.data.push([e,_("CurrikiCode.AssetClass_fw_items_"+e)])});d.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};d.data.subject.mapping.each(function(e){d.data.subsubject.data.push([e.id,_("CurrikiCode.AssetClass_fw_items_"+e.id+".UNSPECIFIED"),e.id]);d.data.subsubject.mapping[e.id].each(function(f){d.data.subsubject.data.push([f.id,_("CurrikiCode.AssetClass_fw_items_"+f.id),e.id])})});d.data.level={list:Curriki.data.el.list,data:[["",_("CurrikiCode.AssetClass_educational_level_UNSPECIFIED")]]};d.data.level.list.each(function(e){d.data.level.data.push([e,_("CurrikiCode.AssetClass_educational_level_"+e)])});d.data.ict={fullList:Curriki.data.ict.list,parentList:{},list:[],data:[["",_("CurrikiCode.AssetClass_instructional_component_UNSPECIFIED","   ")]]};d.data.ict.fullList.each(function(f){var e=f.replace(/_.*/,"");d.data.ict.parentList[e]=e});Object.keys(d.data.ict.parentList).each(function(f){var e=_("CurrikiCode.AssetClass_instructional_component_"+f);if(f==="other"){e="zzz"}d.data.ict.data.push([f,_("CurrikiCode.AssetClass_instructional_component_"+f),e])});d.data.subict={list:Curriki.data.ict.list,parents:{},data:[]};d.data.subict.list.each(function(g){var e=g.replace(/_.*/,"");if(e!==g){if(Ext.isEmpty(d.data.subict.parents[e])){d.data.subict.data.push([e+"*",_("CurrikiCode.AssetClass_instructional_component_"+e+"_UNSPECIFIED"),e,"   "]);d.data.subict.parents[e]=e}var f=_("CurrikiCode.AssetClass_instructional_component_"+g);if(g==="other"){f="zzz"}d.data.subict.data.push([g,_("CurrikiCode.AssetClass_instructional_component_"+g),e,f])}});d.data.language={list:Curriki.data.language.list,data:[["",_("CurrikiCode.AssetClass_language_UNSPECIFIED")]]};d.data.language.list.each(function(e){d.data.language.data.push([e,_("CurrikiCode.AssetClass_language_"+e)])});d.data.category={list:Curriki.data.category.list,data:[["",_("CurrikiCode.AssetClass_category_UNSPECIFIED"),"   "]]};d.data.category.list.each(function(f){var e=_("CurrikiCode.AssetClass_category_"+f);if(f==="unknown"){e="zzz"}if(f!=="collection"){d.data.category.data.push([f,_("CurrikiCode.AssetClass_category_"+f),e])}});d.data.review={list:["partners","highest_rated","members.highest_rated"],data:[["",_("search.resource.review.selector.UNSPECIFIED")]]};d.data.review.list.each(function(e){d.data.review.data.push([e,_("search.resource.review.selector."+e)])});d.data.special={list:["contributions","collections","updated","info-only","also-privates"],data:[["",_("search.resource.special.selector.UNSPECIFIED")]]};d.data.special.list.each(function(e){d.data.special.data.push([e,_("search.resource.special.selector."+e)])});d.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:d.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:d.data.subsubject.data,id:0}),level:new Ext.data.SimpleStore({fields:["id","level"],data:d.data.level.data,id:0}),ict:new Ext.data.SimpleStore({fields:["id","ict","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:d.data.ict.data,id:0}),subict:new Ext.data.SimpleStore({fields:["id","ict","parentICT","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:d.data.subict.data,id:0}),language:new Ext.data.SimpleStore({fields:["id","language"],data:d.data.language.data,id:0}),category:new Ext.data.SimpleStore({fields:["id","category","sortValue"],sortInfo:{field:"sortValue",direction:"ASC"},data:d.data.category.data,id:0}),review:new Ext.data.SimpleStore({fields:["id","review"],data:d.data.review.data,id:0}),special:new Ext.data.SimpleStore({fields:["id","special"],data:d.data.special.data,id:0})};b.store={};b.store.record=new Ext.data.Record.create([{name:"title"},{name:"assetType"},{name:"category"},{name:"subcategory"},{name:"ict"},{name:"ictText"},{name:"ictIcon"},{name:"contributor"},{name:"contributorName"},{name:"rating",mapping:"review"},{name:"memberRating",mapping:"rating"},{name:"ratingCount"},{name:"description"},{name:"fwItems"},{name:"levels"},{name:"parents"},{name:"lastUpdated"},{name:"updated"}]);b.store.results=new Ext.data.Store({storeId:"search-store-"+c,proxy:new Ext.data.HttpProxy({url:document.location.pathname.endsWith("Old")?"/xwiki/bin/view/Search/Resources":"/currikiExtjs",method:"GET"}),baseParams:{xpage:"plain"},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},b.store.record),remoteSort:true});b.store.results.setDefaultSort("title","asc");b.renderer={title:function(q,p,h,o,s,r){var m=h.id.replace(/\./,"/");var i=Ext.util.Format.stripTags(h.data.description);i=Ext.util.Format.ellipsis(i,256);i=Ext.util.Format.htmlEncode(i);var g=Curriki.data.fw_item.getRolloverDisplay(h.data.fwItems||[]);var n=Curriki.data.el.getRolloverDisplay(h.data.levels||[]);var l=h.data.lastUpdated||"";var k="{1}<br />{0}<br /><br />";if(l!==""){k=k+"{7}<br />{6}<br /><br />"}k=k+"{3}<br />{2}<br />{5}<br />{4}";i=String.format(k,i,_("global.title.popup.description"),g,_("global.title.popup.subject"),n,_("global.title.popup.educationlevel"),l,_("global.title.popup.last_updated"));var j=h.data.assetType;var e=h.data.category;var f=h.data.subcategory;p.css=String.format("resource-{0} category-{1} subcategory-{1}_{2}",j,e,f);var t=_(e+"."+f);if(t===e+"."+f){t=_("unknown.unknown")}return String.format('<img class="x-tree-node-icon assettype-icon" src="{3}" ext:qtip="{4}" /><a href="/xwiki/bin/view/{0}" class="asset-title" ext:qtip="{2}">{1}</a>',m,Ext.util.Format.ellipsis(q,80),i,Ext.BLANK_IMAGE_URL,t)},ict:function(l,k,h,j,n,m){var i;var f;var g=h.data.ict;if(!Ext.isEmpty(g)){var e=g.replace(/_.*/,"");i="ict-"+e;if(e!==g){i=i+" ict-"+g}f=g.replace(/_/,".")}else{i="ict-unknown";f="unknown"}k.css=i;return String.format('<img class="ict-icon" src="{1}" /><span class="ict-title">{0}</span>',_("search.resource.ict."+f),Ext.BLANK_IMAGE_URL)},contributor:function(j,h,e,k,g,f){var i=j.replace(/\./,"/");return String.format('<a href="/xwiki/bin/view/{0}">{1}</a>',i,e.data.contributorName)},rating:function(j,h,e,k,g,f){if(j!=""){var i=e.id.replace(/\./,"/");h.css=String.format("crs-{0}",j);return String.format('<a href="/xwiki/bin/view/{3}?viewer=comments"><img class="crs-icon" alt="" src="{2}" /><span class="crs-text">{1}</span></a>',j,_("search.resource.review."+j),Ext.BLANK_IMAGE_URL,i)}else{return String.format("")}},memberRating:function(k,i,f,l,h,g){if(k!=""&&k!="0"&&k!=0){var j=f.id.replace(/\./,"/");var e=f.data.ratingCount;if(e!=""&&e!="0"&&e!=0){i.css=String.format("rating-{0}",k);return String.format('<a href="/xwiki/bin/view/{2}?viewer=comments"><img class="rating-icon" src="{4}" ext:qtip="{3}" /></a><a href="/xwiki/bin/view/{2}?viewer=comments" ext:qtip="{3}"> ({1})</a>',k,e,j,_("search.resource.rating."+k),Ext.BLANK_IMAGE_URL)}else{return String.format("")}}else{return String.format("")}},updated:function(j,h,e,k,g,f){var i=Ext.util.Format.date(j,"M-d-Y");return String.format("{0}",i)}}};Ext.onReady(function(){b.init()})})();(function(){var e="resource";Ext.ns("Curriki.module.search.form."+e);var b=Curriki.module.search;var c=b.form[e];var d=b.data[e];c.init=function(){console.log("form."+e+": init");var g=140;var f=250;c.ictCombo=function(h){Ext.apply(this,h)};Ext.extend(c.ictCombo,Ext.util.Observable,{init:function(h){Ext.apply(h,{tpl:'<tpl for="."><div class="x-combo-list-item ict-icon-combo-item ict-{'+h.valueField+'}"><img class="ict-icon" src="'+Ext.BLANK_IMAGE_URL+'"/><span class="ict-title">{'+h.displayField+"}</span></div></tpl>",onRender:h.onRender.createSequence(function(j,i){this.wrap.applyStyles({position:"relative"});this.el.addClass("ict-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute",children:{tag:"div",cls:"ict-icon"}})}),setIconCls:function(){var i=this.store.query(this.valueField,this.getValue()).itemAt(0);if(i){this.icon.className="ict-icon-combo-icon ict-"+i.get(this.valueField)}},setValue:h.setValue.createSequence(function(i){this.setIconCls()})})}});c.categoryCombo=function(h){Ext.apply(this,h)};Ext.extend(c.categoryCombo,Ext.util.Observable,{init:function(h){Ext.apply(h,{tpl:'<tpl for="."><div class="x-combo-list-item category-icon-combo-item category-{'+h.valueField+'}"><img class="category-icon" src="'+Ext.BLANK_IMAGE_URL+'"/><span class="category-title">{'+h.displayField+"}</span></div></tpl>",onRender:h.onRender.createSequence(function(j,i){this.wrap.applyStyles({position:"relative"});this.el.addClass("category-icon-combo-input");this.icon=Ext.DomHelper.append(this.el.up("div.x-form-field-wrap"),{tag:"div",style:"position:absolute",children:{tag:"div",cls:"category-icon"}})}),setIconCls:function(){var i=this.store.query(this.valueField,this.getValue()).itemAt(0);if(i){this.icon.className="category-icon-combo-icon category-"+i.get(this.valueField)}},setValue:h.setValue.createSequence(function(i){this.setIconCls()})})}});c.termPanel=b.util.createTermPanel(e,c);c.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+e,formId:"search-filterForm-"+e,border:false,items:[c.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+e,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:b.util.fieldsetPanelSave},staterestore:{fn:b.util.fieldsetPanelRestore},expand:{fn:function(h){Ext.getCmp("search-results-"+e).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+e).setWidth(g);Ext.getCmp("search-termPanel-"+e).el.repaint()}},collapse:{fn:function(h){Ext.getCmp("search-results-"+e).getView().refresh();Ext.getCmp("search-termPanel-"+e).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-subject-"+e,fieldLabel:"Subject",hiddenName:"subjectparent",width:g,listWidth:f,mode:"local",store:d.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_fw_items_FW_masterFramework.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(j,i){var h=Ext.getCmp("combo-subsubject-"+e);if(j.getValue()===""){h.clearValue();h.hide()}else{if(j.getValue()==="UNCATEGORIZED"){h.show();h.clearValue();h.store.filter("parentItem",j.getValue());h.setValue(j.getValue());h.hide()}else{h.show();h.clearValue();h.store.filter("parentItem",j.getValue());h.setValue(j.getValue())}}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+e,hiddenName:"subject",width:g,listWidth:f,mode:"local",store:d.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"},{xtype:"combo",id:"combo-category-"+e,fieldLabel:"Category",hiddenName:"category",width:g,listWidth:f,mode:"local",store:d.filter.store.category,displayField:"category",valueField:"id",plugins:new c.categoryCombo(),typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_category_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-level-"+e,fieldLabel:"Level",mode:"local",width:g,listWidth:f,store:d.filter.store.level,hiddenName:"level",displayField:"level",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_educational_level_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-language-"+e,fieldLabel:"Language",hiddenName:"language",width:g,listWidth:f,mode:"local",store:d.filter.store.language,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_language_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-review-"+e,fieldLabel:"Review",hiddenName:"review",width:g,listWidth:f,mode:"local",store:d.filter.store.review,displayField:"review",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.resource.review.selector.UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-ictprfx-"+e,fieldLabel:"Instructional Type",hiddenName:"ictprfx",width:g,listWidth:f,mode:"local",store:d.filter.store.ict,displayField:"ict",valueField:"id",plugins:new c.ictCombo(),typeAhead:true,triggerAction:"all",emptyText:_("CurrikiCode.AssetClass_instructional_component_UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(k,h){var j=Ext.getCmp("combo-subICT-"+e);if(k.getValue()===""){j.clearValue();j.hide()}else{j.clearValue();j.store.filter("parentICT",k.getValue());var i=j.store.getById(k.getValue()+"*");if(Ext.isEmpty(i)){j.setValue(k.getValue());j.hide()}else{j.setValue(k.getValue()+"*");j.show()}}}}}},{xtype:"combo",fieldLabel:"Sub ICT",hiddenName:"ict",width:g,listWidth:f,id:"combo-subICT-"+e,mode:"local",store:d.filter.store.subict,displayField:"ict",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:"Select a Sub ICT...",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"},{xtype:"combo",id:"combo-special-"+e,fieldLabel:"Special Filters",hiddenName:"special",width:g,listWidth:f,mode:"local",store:d.filter.store.special,displayField:"special",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.resource.special.selector.UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};c.rowExpander=new Ext.grid.RowExpander({tpl:new Ext.XTemplate(_("search.resource.resource.expanded.title"),"<ul>",'<tpl for="parents">','<li class="resource-{assetType} category-{category} subcategory-{category}_{subcategory}">','<a href="{[this.getParentURL(values)]}" ext:qtip="{[this.getQtip(values)]}">',"{title}","</a>","</li>","</tpl>","</ul>",{getParentURL:function(h){var i=h.page||false;if(i){return"/xwiki/bin/view/"+i.replace(/\./,"/")}else{return""}},getQtip:function(h){var k=Curriki.module.search.data.resource.filter;var l=Ext.util.Format.stripTags(h.description||"");l=Ext.util.Format.ellipsis(l,256);l=Ext.util.Format.htmlEncode(l);var j=Curriki.data.fw_item.getRolloverDisplay(h.fwItems||[]);var i=Curriki.data.el.getRolloverDisplay(h.levels||[]);return String.format("{1}<br />{0}<br /><br />{3}<br />{2}<br />{5}<br />{4}",l,_("global.title.popup.description"),j,_("global.title.popup.subject"),i,_("global.title.popup.educationlevel"))}})});c.rowExpander.renderer=function(j,k,i){var h;if(i.data.parents&&i.data.parents.size()>0){k.cellAttr='rowspan="2"';h="x-grid3-row-expander";return String.format('<img class="{0}" src="{1}" ext:qtip="{2}" />',h,Ext.BLANK_IMAGE_URL,_("search.resource.icon.plus.rollover"))}else{h="x-grid3-row-expander-empty";return String.format('<img class="{0}" src="{1}" />',h,Ext.BLANK_IMAGE_URL)}};c.rowExpander.on("expand",function(m,j,i,h){var l=m.grid.view.getRow(h);var k=Ext.DomQuery.selectNode("img[class=x-grid3-row-expander]",l);Ext.fly(k).set({"ext:qtip":_("search.resource.icon.minus.rollover")})});c.rowExpander.on("collapse",function(m,j,i,h){var l=m.grid.view.getRow(h);var k=Ext.DomQuery.selectNode("img[class=x-grid3-row-expander]",l);Ext.fly(k).set({"ext:qtip":_("search.resource.icon.plus.rollover")})});c.columnModel=new Ext.grid.ColumnModel([Ext.apply(c.rowExpander,{}),{id:"title",header:_("search.resource.column.header.title"),width:164,dataIndex:"title",sortable:true,hideable:false,renderer:d.renderer.title},{id:"ict",width:108,header:_("search.resource.column.header.ict"),dataIndex:"ictText",sortable:true,renderer:d.renderer.ict},{id:"contributor",width:110,header:_("search.resource.column.header.contributor"),dataIndex:"contributor",sortable:true,renderer:d.renderer.contributor},{id:"rating",width:88,header:_("search.resource.column.header.rating"),dataIndex:"rating",sortable:true,renderer:d.renderer.rating},{id:"memberRating",width:105,header:_("search.resource.column.header.member.rating"),dataIndex:"memberRating",sortable:true,renderer:d.renderer.memberRating},{id:"updated",width:80,header:_("search.resource.column.header.updated"),dataIndex:"updated",hidden:true,sortable:true,renderer:d.renderer.updated}]);c.resultsPanel={xtype:"grid",id:"search-results-"+e,border:false,autoHeight:true,width:b.settings.gridWidth,autoExpandColumn:"title",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:d.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:c.columnModel,loadMask:false,plugins:c.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+e,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:d.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+e),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};c.mainPanel={xtype:"panel",id:"search-panel-"+e,autoHeight:true,items:[c.filterPanel,c.resultsPanel]};c.doSearch=function(){b.util.doSearch(e)};b.util.registerTabTitleListener(e)};Ext.onReady(function(){c.init()})})();(function(){var c="group";Ext.ns("Curriki.module.search.data."+c);var b=Curriki.module.search.data.group;b.init=function(){console.log("data."+c+": init");b.filter={};var d=b.filter;d.data={};d.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("XWiki.CurrikiSpaceClass_topic_FW_masterFramework.WebHome.UNSPECIFIED")]]};d.data.subject.mapping.each(function(e){d.data.subject.list.push(e.id)});d.data.subject.list.each(function(e){d.data.subject.data.push([e,_("XWiki.CurrikiSpaceClass_topic_"+e)])});d.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};d.data.subject.mapping.each(function(e){d.data.subsubject.data.push([e.id,_("XWiki.CurrikiSpaceClass_topic_"+e.id+".UNSPECIFIED"),e.id]);d.data.subsubject.mapping[e.id].each(function(f){d.data.subsubject.data.push([f.id,_("XWiki.CurrikiSpaceClass_topic_"+f.id),e.id])})});d.data.level={list:Curriki.data.el.list,data:[["",_("XWiki.CurrikiSpaceClass_educationLevel_UNSPECIFIED")]]};d.data.level.list.each(function(e){d.data.level.data.push([e,_("XWiki.CurrikiSpaceClass_educationLevel_"+e)])});d.data.policy={list:["open","closed"],data:[["",_("search.XWiki.SpaceClass_policy_UNSPECIFIED")]]};d.data.policy.list.each(function(e){d.data.policy.data.push([e,_("search.XWiki.SpaceClass_policy_"+e)])});d.data.language={list:Curriki.data.language.list,data:[["",_("XWiki.CurrikiSpaceClass_language_UNSPECIFIED")]]};d.data.language.list.each(function(e){d.data.language.data.push([e,_("XWiki.CurrikiSpaceClass_language_"+e)])});d.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:d.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:d.data.subsubject.data,id:0}),level:new Ext.data.SimpleStore({fields:["id","level"],data:d.data.level.data,id:0}),policy:new Ext.data.SimpleStore({fields:["id","policy"],data:d.data.policy.data,id:0}),language:new Ext.data.SimpleStore({fields:["id","language"],data:d.data.language.data,id:0})};b.store={};b.store.record=new Ext.data.Record.create([{name:"title"},{name:"url"},{name:"policy"},{name:"description"},{name:"updated"}]);b.store.results=new Ext.data.Store({storeId:"search-store-"+c,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Groups",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},b.store.record),remoteSort:true});b.store.results.setDefaultSort("title","asc");b.renderer={title:function(i,h,e,j,g,f){return String.format('<a href="{0}">{1}</a>',e.data.url,i)},policy:function(i,h,e,k,g,f){if(i!==""){h.css="policy-"+i}var j=_("search.group.icon."+i);return String.format('<span ext:qtip="{1}">{0}</span>',j,_("search.group.icon."+i+".rollover"))},description:function(i,h,e,k,g,f){var j=Ext.util.Format.htmlDecode(i);j=Ext.util.Format.stripScripts(i);j=Ext.util.Format.stripTags(j);j=Ext.util.Format.ellipsis(j,128);j=Ext.util.Format.htmlEncode(j);j=Ext.util.Format.trim(j);return String.format("{0}",j)},updated:function(j,h,e,k,g,f){var i=Ext.util.Format.date(j,"M-d-Y");return String.format("{0}",i)}}};Ext.onReady(function(){b.init()})})();(function(){var e="group";Ext.ns("Curriki.module.search.form."+e);var b=Curriki.module.search;var c=b.form[e];var d=b.data[e];c.init=function(){console.log("form."+e+": init");var g=140;var f=250;c.termPanel=b.util.createTermPanel(e,c);c.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+e,formId:"search-filterForm-"+e,border:false,items:[c.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+e,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:b.util.fieldsetPanelSave},staterestore:{fn:b.util.fieldsetPanelRestore},expand:{fn:function(h){Ext.getCmp("search-results-"+e).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+e).setWidth(g);Ext.getCmp("search-termPanel-"+e).el.repaint()}},collapse:{fn:function(h){Ext.getCmp("search-results-"+e).getView().refresh();Ext.getCmp("search-termPanel-"+e).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",fieldLabel:"Subject",id:"combo-subject-"+e,hiddenName:"subjectparent",width:g,listWidth:f,mode:"local",store:d.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_topic_FW_masterFramework.WebHome.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(j,i){var h=Ext.getCmp("combo-subsubject-"+e);if(j.getValue()===""){h.clearValue();h.hide()}else{h.show();h.clearValue();h.store.filter("parentItem",j.getValue());h.setValue(j.getValue())}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+e,hiddenName:"subject",width:g,listWidth:f,mode:"local",store:d.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-level-"+e,fieldLabel:"Level",mode:"local",width:g,listWidth:f,store:d.filter.store.level,hiddenName:"level",displayField:"level",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_educationLevel_UNSPECIFIED"),selectOnFocus:true,forceSelection:true},{xtype:"combo",id:"combo-language-"+e,fieldLabel:"Language",hiddenName:"language",mode:"local",width:g,listWidth:f,store:d.filter.store.language,displayField:"language",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.CurrikiSpaceClass_language_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-policy-"+e,fieldLabel:"Membership Policy",hiddenName:"policy",mode:"local",width:g,listWidth:f,store:d.filter.store.policy,displayField:"policy",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("search.XWiki.SpaceClass_policy_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};c.columnModel=new Ext.grid.ColumnModel([{id:"policy",header:_("search.group.column.header.policy"),width:62,dataIndex:"policy",sortable:true,renderer:d.renderer.policy},{id:"title",header:_("search.group.column.header.name"),width:213,dataIndex:"title",sortable:true,hideable:false,renderer:d.renderer.title},{id:"description",width:225,header:_("search.group.column.header.description"),dataIndex:"description",sortable:false,renderer:d.renderer.description},{id:"updated",width:96,header:_("search.group.column.header.updated"),dataIndex:"updated",sortable:true,renderer:d.renderer.updated}]);c.resultsPanel={xtype:"grid",id:"search-results-"+e,border:false,autoHeight:true,width:b.settings.gridWidth,autoExpandColumn:"description",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:d.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:c.columnModel,loadMask:false,plugins:c.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+e,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:d.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+e),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};c.mainPanel={xtype:"panel",id:"search-panel-"+e,autoHeight:true,items:[c.filterPanel,c.resultsPanel]};c.doSearch=function(){b.util.doSearch(e)};b.util.registerTabTitleListener(e)};Ext.onReady(function(){c.init()})})();(function(){var c="member";Ext.ns("Curriki.module.search.data."+c);var b=Curriki.module.search.data.member;b.init=function(){console.log("data."+c+": init");b.filter={};var d=b.filter;d.data={};d.data.subject={mapping:Curriki.data.fw_item.fwMap["FW_masterFramework.WebHome"],list:[],data:[["",_("XWiki.XWikiUsers_topics_FW_masterFramework.WebHome.UNSPECIFIED")]]};d.data.subject.mapping.each(function(e){d.data.subject.list.push(e.id)});d.data.subject.list.each(function(e){d.data.subject.data.push([e,_("XWiki.XWikiUsers_topics_"+e)])});d.data.subsubject={mapping:Curriki.data.fw_item.fwMap,data:[]};d.data.subject.mapping.each(function(e){d.data.subsubject.data.push([e.id,_("XWiki.XWikiUsers_topics_"+e.id+".UNSPECIFIED"),e.id]);d.data.subsubject.mapping[e.id].each(function(f){d.data.subsubject.data.push([f.id,_("XWiki.XWikiUsers_topics_"+f.id),e.id])})});d.data.country={list:"AD|AE|AF|AG|AI|AL|AM|AN|AO|AQ|AR|AS|AT|AU|AW|AX|AZ|BA|BB|BD|BE|BF|BG|BH|BI|BJ|BM|BN|BO|BR|BS|BT|BV|BW|BY|BZ|CA|CC|CD|CF|CG|CH|CI|CK|CL|CM|CN|CO|CR|CU|CV|CX|CY|CZ|DE|DJ|DK|DM|DO|DZ|EC|EE|EG|EH|ER|ES|ET|FI|FJ|FK|FM|FO|FR|GA|GB|GD|GE|GF|GG|GH|GI|GL|GM|GN|GP|GQ|GR|GS|GT|GU|GW|GY|HK|HM|HN|HR|HT|HU|ID|IE|IL|IM|IN|IO|IQ|IR|IS|IT|JE|JM|JO|JP|KE|KG|KH|KI|KM|KN|KP|KR|KW|KY|KZ|LA|LB|LC|LI|LK|LR|LS|LT|LU|LV|LY|MA|MC|MD|ME|MG|MH|MK|ML|MM|MN|MO|MP|MQ|MR|MS|MT|MU|MV|MW|MX|MY|MZ|NA|NC|NE|NF|NG|NI|NL|NO|NP|NR|NU|NZ|OM|PA|PE|PF|PG|PH|PK|PL|PM|PN|PR|PS|PT|PW|PY|QA|RE|RO|RS|RU|RW|SA|SB|SC|SD|SE|SG|SH|SI|SJ|SK|SL|SM|SN|SO|SR|ST|SV|SY|SZ|TC|TD|TF|TG|TH|TJ|TK|TL|TM|TN|TO|TR|TT|TV|TW|TZ|UA|UG|UM|US|UY|UZ|VA|VC|VE|VG|VI|VN|VU|WF|WS|YE|YT|ZA|ZM|ZW".split("|"),data:[["",_("XWiki.XWikiUsers_country_UNSPECIFIED")]]};d.data.country.list.each(function(e){d.data.country.data.push([e,_("XWiki.XWikiUsers_country_"+e)])});d.data.member_type={list:["student","parent","professional","teacher","administration"],data:[["",_("XWiki.XWikiUsers_member_type_UNSPECIFIED")]]};d.data.member_type.list.each(function(e){d.data.member_type.data.push([e,_("XWiki.XWikiUsers_member_type_"+e)])});d.store={subject:new Ext.data.SimpleStore({fields:["id","subject"],data:d.data.subject.data,id:0}),subsubject:new Ext.data.SimpleStore({fields:["id","subject","parentItem"],data:d.data.subsubject.data,id:0}),member_type:new Ext.data.SimpleStore({fields:["id","member_type"],data:d.data.member_type.data,id:0}),country:new Ext.data.SimpleStore({fields:["id","country"],data:d.data.country.data,id:0})};b.store={};b.store.record=new Ext.data.Record.create([{name:"name1"},{name:"name2"},{name:"url"},{name:"bio"},{name:"picture"},{name:"contributions"}]);b.store.results=new Ext.data.Store({storeId:"search-store-"+c,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Members",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},b.store.record),remoteSort:true});b.store.results.setDefaultSort("name1","asc");b.renderer={name1:function(i,h,e,j,g,f){return String.format('<a href="{1}">{0}</a>',i,e.data.url)},name2:function(i,h,e,j,g,f){return String.format('<a href="{1}">{0}</a>',i,e.data.url)},picture:function(i,h,e,j,g,f){return String.format('<a href="{2}"><img src="{0}" alt="{1}" class="member-picture" style="width:88px" /></a>',i,_("search.member.column.picture.alt.text"),e.data.url)},contributions:function(i,h,e,j,g,f){return String.format("{0}",i)},bio:function(i,h,e,k,g,f){var j=Ext.util.Format.htmlDecode(i);j=Ext.util.Format.stripScripts(i);j=Ext.util.Format.stripTags(j);j=Ext.util.Format.ellipsis(j,128);j=Ext.util.Format.htmlEncode(j);j=Ext.util.Format.trim(j);return String.format("{0}",j)}}};Ext.onReady(function(){b.init()})})();(function(){var e="member";Ext.ns("Curriki.module.search.form."+e);var b=Curriki.module.search;var c=b.form[e];var d=b.data[e];c.init=function(){console.log("form."+e+": init");var g=140;var f=250;c.termPanel=b.util.createTermPanel(e,c);c.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+e,formId:"search-filterForm-"+e,border:false,items:[c.termPanel,{xtype:"fieldset",title:_("search.advanced.search.button"),id:"search-advanced-"+e,autoHeight:true,collapsible:true,collapsed:true,animCollapse:false,border:true,stateful:true,stateEvents:["expand","collapse"],listeners:{statesave:{fn:b.util.fieldsetPanelSave},staterestore:{fn:b.util.fieldsetPanelRestore},expand:{fn:function(h){Ext.getCmp("search-results-"+e).getView().refresh();Ext.select(".x-form-field-wrap",false,"search-advanced-"+e).setWidth(g);Ext.getCmp("search-termPanel-"+e).el.repaint()}},collapse:{fn:function(h){Ext.getCmp("search-results-"+e).getView().refresh();Ext.getCmp("search-termPanel-"+e).el.repaint()}}},items:[{layout:"column",border:false,defaults:{border:false,hideLabel:true},items:[{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-subject-"+e,fieldLabel:"Subject",hiddenName:"subjectparent",width:g,listWidth:f,mode:"local",store:d.filter.store.subject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_topics_FW_masterFramework.WebHome.UNSPECIFIED"),selectOnFocus:true,forceSelection:true,listeners:{select:{fn:function(j,i){var h=Ext.getCmp("combo-subsubject-"+e);if(j.getValue()===""){h.clearValue();h.hide()}else{h.show();h.clearValue();h.store.filter("parentItem",j.getValue());h.setValue(j.getValue())}}}}},{xtype:"combo",fieldLabel:"Sub Subject",id:"combo-subsubject-"+e,hiddenName:"subject",width:g,listWidth:f,mode:"local",store:d.filter.store.subsubject,displayField:"subject",valueField:"id",typeAhead:true,triggerAction:"all",selectOnFocus:true,forceSelection:true,lastQuery:"",hidden:true,hideMode:"visibility"}]},{columnWidth:0.33,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-member_type-"+e,fieldLabel:"Member Type",mode:"local",width:g,listWidth:f,store:d.filter.store.member_type,hiddenName:"member_type",displayField:"member_type",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_member_type_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]},{columnWidth:0.34,layout:"form",defaults:{hideLabel:true},items:[{xtype:"combo",id:"combo-country-"+e,fieldLabel:"Country",hiddenName:"country",width:g,listWidth:f,mode:"local",store:d.filter.store.country,displayField:"country",valueField:"id",typeAhead:true,triggerAction:"all",emptyText:_("XWiki.XWikiUsers_country_UNSPECIFIED"),selectOnFocus:true,forceSelection:true}]}]}]}]};c.columnModelList=[{id:"picture",header:_("search.member.column.header.picture"),width:116,dataIndex:"picture",sortable:false,resizable:false,menuDisabled:true,renderer:d.renderer.picture},{id:"name1",header:_("search.member.column.header.name1"),width:120,dataIndex:"name1",sortable:true,hideable:false,renderer:d.renderer.name1},{id:"name2",width:120,header:_("search.member.column.header.name2"),dataIndex:"name2",sortable:true,hideable:false,renderer:d.renderer.name2},{id:"bio",width:120,header:_("search.member.column.header.bio"),dataIndex:"bio",sortable:false,renderer:d.renderer.bio},{id:"contributions",width:120,header:_("search.member.column.header.contributions"),dataIndex:"contributions",sortable:false,renderer:d.renderer.contributions}];c.columnModel=new Ext.grid.ColumnModel(c.columnModelList);c.resultsPanel={xtype:"grid",id:"search-results-"+e,border:false,autoHeight:true,width:b.settings.gridWidth,autoExpandColumn:"bio",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:d.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:c.columnModel,loadMask:false,plugins:c.rowExpander,bbar:new Ext.PagingToolbar({id:"search-pager-"+e,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:d.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+e),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};c.mainPanel={xtype:"panel",id:"search-panel-"+e,autoHeight:true,items:[c.filterPanel,c.resultsPanel]};c.doSearch=function(){b.util.doSearch(e)};b.util.registerTabTitleListener(e)};Ext.onReady(function(){c.init()})})();(function(){var c="blog";Ext.ns("Curriki.module.search.data."+c);var b=Curriki.module.search.data.blog;b.init=function(){console.log("data."+c+": init");b.store={};b.store.record=new Ext.data.Record.create([{name:"name"},{name:"title"},{name:"text"},{name:"comments"},{name:"updated"},{name:"memberUrl"},{name:"blogUrl"}]);b.store.results=new Ext.data.Store({storeId:"search-store-"+c,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Blogs",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount",id:"page"},b.store.record),remoteSort:true});b.store.results.setDefaultSort("updated","desc");b.renderer={name:function(h,g,d,i,f,e){return String.format('<a href="{1}">{0}</a>',h,d.data.memberUrl)},text:function(h,g,d,j,f,e){var i=Ext.util.Format.htmlDecode(h);i=Ext.util.Format.stripScripts(h);i=Ext.util.Format.stripTags(i);i=Ext.util.Format.trim(i);i=Ext.util.Format.ellipsis(i,128);return String.format('<a href="{2}" class="search-blog-title">{1}</a><br /><br />{0}',i,d.data.title,d.data.blogUrl)},comments:function(h,g,d,i,f,e){return String.format("{0}",h)},updated:function(i,g,d,j,f,e){var h=Ext.util.Format.date(i,"M-d-Y");return String.format("{0}",h)}}};Ext.onReady(function(){b.init()})})();(function(){var e="blog";Ext.ns("Curriki.module.search.form."+e);var b=Curriki.module.search;var c=b.form[e];var d=b.data[e];c.init=function(){console.log("form."+e+": init");c.termPanel=b.util.createTermPanel(e,c);c.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+e,formId:"search-filterForm-"+e,border:false,items:[c.termPanel]};c.columnModel=new Ext.grid.ColumnModel([{id:"name",header:_("search.blog.column.header.name"),width:160,dataIndex:"name",sortable:true,renderer:d.renderer.name},{id:"text",header:_("search.blog.column.header.text"),width:260,dataIndex:"text",sortable:false,renderer:d.renderer.text},{id:"comments",header:_("search.blog.column.header.comments"),width:80,dataIndex:"comments",sortable:false,renderer:d.renderer.comments},{id:"updated",width:96,header:_("search.blog.column.header.updated"),dataIndex:"updated",sortable:true,renderer:d.renderer.updated}]);c.resultsPanel={xtype:"grid",id:"search-results-"+e,border:false,autoHeight:true,width:b.settings.gridWidth,autoExpandColumn:"text",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:d.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:c.columnModel,loadMask:false,bbar:new Ext.PagingToolbar({id:"search-pager-"+e,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:d.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+e),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};c.mainPanel={xtype:"panel",id:"search-panel-"+e,autoHeight:true,items:[c.filterPanel,c.resultsPanel]};c.doSearch=function(){b.util.doSearch(e)};b.util.registerTabTitleListener(e)};Ext.onReady(function(){c.init()})})();(function(){var c="curriki";Ext.ns("Curriki.module.search.data."+c);var b=Curriki.module.search.data.curriki;b.init=function(){console.log("data."+c+": init");b.store={};b.store.record=new Ext.data.Record.create([{name:"name"},{name:"updated"},{name:"url"}]);b.store.results=new Ext.data.Store({storeId:"search-store-"+c,proxy:new Ext.data.HttpProxy({url:"/xwiki/bin/view/Search/Curriki",method:"GET"}),baseParams:{xpage:"plain",_dc:(new Date().getTime())},reader:new Ext.data.JsonReader({root:"rows",totalProperty:"resultCount"},b.store.record),remoteSort:true});b.store.results.setDefaultSort("name","asc");b.renderer={name:function(h,g,d,i,f,e){return String.format('<a href="{1}">{0}</a>',h,d.data.url)},updated:function(i,g,d,j,f,e){var h=Ext.util.Format.date(i,"M-d-Y");return String.format("{0}",h)}}};Ext.onReady(function(){b.init()})})();(function(){var e="curriki";Ext.ns("Curriki.module.search.form."+e);var b=Curriki.module.search;var c=b.form[e];var d=b.data[e];c.init=function(){console.log("form."+e+": init");c.termPanel=b.util.createTermPanel(e,c);c.filterPanel={xtype:"form",labelAlign:"left",id:"search-filterPanel-"+e,formId:"search-filterForm-"+e,border:false,items:[c.termPanel]};c.columnModel=new Ext.grid.ColumnModel([{id:"name",header:_("search.curriki.column.header.name"),width:500,dataIndex:"name",sortable:true,renderer:d.renderer.name},{id:"updated",width:96,header:_("search.curriki.column.header.updated"),dataIndex:"updated",sortable:true,renderer:d.renderer.updated}]);c.resultsPanel={xtype:"grid",id:"search-results-"+e,border:false,autoHeight:true,width:b.settings.gridWidth,autoExpandColumn:"name",stateful:true,frame:false,stripeRows:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,scrollOffset:0},columnsText:_("search.columns.menu.columns"),sortAscText:_("search.columns.menu.sort_ascending"),sortDescText:_("search.columns.menu.sort_descending"),store:d.store.results,sm:new Ext.grid.RowSelectionModel({selectRow:Ext.emptyFn}),cm:c.columnModel,loadMask:false,bbar:new Ext.PagingToolbar({id:"search-pager-"+e,plugins:new Ext.ux.Andrie.pPageSize({variations:[10,25,50],beforeText:_("search.pagination.pagesize.before"),afterText:_("search.pagination.pagesize.after"),addBefore:_("search.pagination.pagesize.addbefore"),addAfter:_("search.pagination.pagesize.addafter")}),pageSize:25,store:d.store.results,displayInfo:true,displayMsg:_("search.pagination.displaying."+e),emptyMsg:_("search.find.no.results"),beforePageText:_("search.pagination.beforepage"),afterPageText:_("search.pagination.afterpage"),firstText:_("search.pagination.first"),prevText:_("search.pagination.prev"),nextText:_("search.pagination.next"),lastText:_("search.pagination.last"),refreshText:_("search.pagination.refresh")})};c.mainPanel={xtype:"panel",id:"search-panel-"+e,autoHeight:true,items:[c.filterPanel,c.resultsPanel]};c.doSearch=function(){b.util.doSearch(e)};b.util.registerTabTitleListener(e)};Ext.onReady(function(){c.init()})})();(function(){Ext.ns("Curriki.module.search.form");var c=Curriki.module.search;var b=c.form;c.init=function(){console.log("search: init");if(Ext.isEmpty(c.initialized)){if(Ext.isEmpty(c.tabList)){c.tabList=["resource","group","member","curriki"]}var e=140;c.doSearch=function(k,i,j){var g={};if(Ext.getCmp("search-termPanel")&&Ext.getCmp("search-termPanel").getForm){g.all=Ext.getCmp("search-termPanel").getForm().getValues(false)}var l={};var f={};Ext.each(c.tabList,function(s){var r=b[s];if(!Ext.isEmpty(r)&&!Ext.isEmpty(r.doSearch)){var q=Ext.getCmp("search-filterPanel-"+s);if(!Ext.isEmpty(q)){var t=q.getForm();if(!Ext.isEmpty(t)){g[s]=t.getValues(false);if("undefined"!==typeof g[s]["terms"]&&g[s]["terms"]===_("search.text.entry.label")){delete (g[s]["terms"])}if("undefined"!==typeof g[s]["other"]&&g[s]["other"]===""){delete (g[s]["other"])}}}var o=Ext.getCmp("search-advanced-"+s);if(!Ext.isEmpty(o)){if(!o.collapsed){f[s]={a:true}}}var p=Ext.getCmp("search-pager-"+s);if(!Ext.isEmpty(p)){var u={};u.c=(("undefined"===typeof i)||(i!==true))?p.cursor:0;u.s=p.pageSize;l[s]=u}if((("undefined"===typeof j)||(j=false))&&(Ext.isEmpty(k)||k===s)){console.log("now util.doSearch",s,l);c.util.doSearch(s,(("undefined"!==typeof l[s])?l[s].c:0))}}});var h={};h.s=Ext.isEmpty(k)?"all":k;h.f=g;h.p=l;if(Ext.getCmp("search-tabPanel").getActiveTab){h.t=Ext.getCmp("search-tabPanel").getActiveTab().id}h.a=f;var m=new Ext.state.Provider();var n=m.encodeValue(h);console.log("Saving History",{values:h});if(c.history.lastHistoryToken){c.history.setLastToken(n);Ext.History.add(n)}else{c.history.setLastToken(n);window.location.replace(window.location.pathname+"#"+n)}};c.tabPanel={xtype:(c.tabList.size()>1?"tab":"")+"panel",id:"search-tabPanel",activeTab:0,deferredRender:false,autoHeight:true,layoutOnTabChange:true,frame:false,border:false,plain:true,defaults:{autoScroll:false,border:false},listeners:{tabchange:function(i,h){var g=h.id.replace(/(^search-|-tab$)/g,"");Curriki.logView("/features/search/"+g);var f=Ext.getCmp("search-advanced-"+g);if(!Ext.isEmpty(f)){if(!f.collapsed){Ext.select(".x-form-field-wrap",false,"search-advanced-"+g).setWidth(e)}}}},items:[]};Ext.each(c.tabList,function(f){panel={title:_("search."+f+".tab.title"),id:"search-"+f+"-tab",cls:"search-"+f,autoHeight:true};module=b[f];if(!Ext.isEmpty(module)&&!Ext.isEmpty(module.mainPanel)){panel.items=[module.mainPanel];c.tabPanel.items.push(panel)}});c.mainPanel={el:"search-div",border:false,height:"600px",defaults:{border:false},cls:"search-module",items:[c.tabPanel]};Ext.ns("Curriki.module.search.history");var d=c.history;d.lastHistoryToken=false;d.historyChange=function(f){if(f){if(f==d.lastHistoryToken){}else{d.updateFromHistory(f)}}else{}};d.setLastToken=function(f){d.lastHistoryToken=f};d.updateFromHistory=function(g){var k=new Ext.state.Provider();var f=k.decodeValue(g);console.log("Got History",{token:g,values:f});if(!Ext.isEmpty(f)){var j=f.f;if(!Ext.isEmpty(j)&&j.all&&Ext.getCmp("search-termPanel")&&Ext.getCmp("search-termPanel").getForm){Ext.getCmp("search-termPanel").getForm().setValues(j.all)}var h=f.p;var i=f.a;if(f.t){if(Ext.getCmp("search-tabPanel").setActiveTab){Ext.getCmp("search-tabPanel").setActiveTab(f.t)}}Ext.each(c.tabList,function(p){console.log("Updating "+p);var o=c.form[p];if(!Ext.isEmpty(o)&&!Ext.isEmpty(o.doSearch)&&!Ext.isEmpty(j)&&!Ext.isEmpty(j[p])){var n=Ext.getCmp("search-filterPanel-"+p);if(!Ext.isEmpty(n)){var r=n.getForm();if(!Ext.isEmpty(r)){try{r.setValues(j[p]);var q=Ext.getCmp("combo-subject-"+p);if(q){q.fireEvent("select",q,q.getValue());if(!Ext.isEmpty(j[p].subject)){if(Ext.getCmp("combo-subsubject-"+p)){Ext.getCmp("combo-subsubject-"+p).setValue(j[p].subject)}}}q=Ext.getCmp("combo-ictprfx-"+p);if(q){q.fireEvent("select",q,q.getValue());if(!Ext.isEmpty(j[p].ict)){if(Ext.getCmp("combo-subICT-"+p)){Ext.getCmp("combo-subICT-"+p).setValue(j[p].ict)}}}}catch(s){console.log("ERROR Updating "+p,s)}}}if(!Ext.isEmpty(i)&&!Ext.isEmpty(i[p])&&i[p].a){var m=Ext.getCmp("search-advanced-"+p);if(!Ext.isEmpty(m)){m.expand(false)}}var l=Ext.getCmp("search-pager-"+p);if(!Ext.isEmpty(l)&&!Ext.isEmpty(h)){if(h[p]){try{if(h[p]["c"]){l.cursor=h[p]["c"]}if(h[p]["s"]){if(l.pageSize!=h[p]["s"]){l.setPageSize(h[p]["s"])}}}catch(s){console.log("ERROR Updating "+p,s)}}}}});if(f.s){console.log("Starting search");if(f.s==="all"){c.doSearch()}else{c.doSearch(f.s)}}d.setLastToken(g)}};d.init=function(){if(Ext.isEmpty(d.initialized)){var f=Ext.History.getToken();Ext.History.init(function(){Ext.History.on("change",d.historyChange);if(f){d.historyChange(f)}});d.initialized=true}};c.initialized=true;console.log("search: init done")}};c.display=function(){c.init();var d=new Ext.Panel(c.mainPanel);d.render();c.history.init()};c.start=function(){Ext.onReady(function(){c.display()})}})();