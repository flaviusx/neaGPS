(function(){Ext.ns("Curriki.module.reorder");Ext.ns("Curriki.data.reorder");var A=Curriki.module.reorder;var C=Curriki.data.reorder;var D=Curriki.ui;var B="mycurriki.collections.reorder.";if(C.place&&C.place==="groups"){B="groups_curriculum_collections_reorder."}A.init=function(){if(!C.place||!C.which){return false}A.store=new Ext.data.JsonStore({storeId:"CollectionsStore",url:"/xwiki/curriki/"+C.place+"/"+C.which+"/collections",fields:["displayTitle","collectionPage"],autoLoad:true});A.mainDlg=Ext.extend(D.dialog.Messages,{initComponent:function(){Ext.apply(this,{id:"ReorderDialogueWindow",title:_(B+"dialog_title"),cls:"reorder resource",autoScroll:false,width:634,items:[{xtype:"panel",id:"guidingquestion-container",cls:"guidingquestion-container",items:[{xtype:"box",autoEl:{tag:"div",html:_(B+"guidingquestion"),cls:"guidingquestion"}},{xtype:"box",autoEl:{tag:"div",html:_(B+"instruction"),cls:"instruction"}}]},{xtype:"panel",id:"collections-list-panel",cls:"collections-list",bbar:["->",{text:_(B+"cancel.btt"),id:"cancelbutton",cls:"button cancel",listeners:{click:{fn:function(){this.close()},scope:this}}},{text:_(B+"next.btt"),id:"nextbutton",cls:"button next",listeners:{click:{fn:function(){var E=[];Ext.getCmp("reorderCollectionsMS").store.each(function(F){E.push(F.data.collectionPage)});console.log("Reordering",E);A.msgComplete();window.location.reload()},scope:this}}}],items:[{xtype:"box",autoEl:{tag:"div",html:_(B+"listheader"),cls:"listheader"}},{xtype:"form",id:"ReorderDialoguePanel",formId:"ReorderDialogueForm",labelWidth:25,autoScroll:false,border:false,defaults:{labelSeparator:""},listeners:{},items:[{xtype:"multiselect",id:"reorderCollectionsMS",name:"reorderCollections",hideLabel:true,border:false,enableToolbar:false,legend:" ",store:A.store,valueField:"collectionPage",displayField:'[""]}<span class="resource-CollectionComposite"><img style="width:16px; height:13px;" class="x-tree-node-icon assettype-icon" src="'+Ext.BLANK_IMAGE_URL+'" /></span> {displayTitle',width:600,height:200,allowBlank:false,preventMark:true,minLength:1,isFormField:true,dragGroup:"reorderMSGroup",dropGroup:"reorderMSGroup"}]}]}]});A.mainDlg.superclass.initComponent.call(this)}});Ext.reg("reorderDialog",A.mainDlg);A.msgComplete=function(){alert(_(B+"set.confirm"))};A.initialized=true;return true};A.confirmMsg={first:function(){return confirm(B+"checkfirst.dialog")},after:function(){return confirm(B+"checkafter.dialog")},display:function(){if(!C.reordered){return A.confirmMsg.first()}else{return A.confirmMsg.after()}}};A.display=function(){Ext.QuickTips.init();if(A.init()){D.show("reorderDialog")}};A.start=function(){Ext.onReady(function(){if(A.confirmMsg.display()){A.display()}})};Ext.onReady(function(){if(!C.place||!C.which){return }var E=Ext.DomQuery.selectNode("#hider-link");if(E){Ext.DomHelper.insertBefore(E,{id:"reorder-link",tag:"a",cls:"reorder-link",onclick:"Curriki.module.reorder.start(); return false;",html:_(B+"link")});Ext.DomHelper.insertBefore(E,{id:"reorder-sep",tag:"span",cls:"separator",html:"|"})}})})();