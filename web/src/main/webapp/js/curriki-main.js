Ext.override(Ext.layout.FormLayout,{adjustWidthAnchor:function(C,B){return C-(B.isFormField?(B.hideLabel?0:this.labelAdjust):0)-B.el.getMargins("lr")}});Ext.override(Ext.layout.AnchorLayout,{getAnchorViewSize:function(B,D){var C=B.body||B.el;return{width:C.dom.clientWidth-C.getPadding("lr"),height:C.dom.clientHeight-C.getPadding("tb")}},adjustWidthAnchor:function(C,B){return C-B.el.getMargins("lr")},adjustHeightAnchor:function(C,B){return C-B.el.getMargins("tb")}});Ext.override(Ext.Component,{saveState:function(){if(Ext.state.Manager&&this.stateful!==false){var B=this.getState();if(this.fireEvent("beforestatesave",this,B)!==false){Ext.state.Manager.set(this.stateId||this.id,B);this.fireEvent("statesave",this,B)}}},stateful:false});Ext.override(Ext.form.TriggerField,{onShow:function(){if(this.wrap){this.wrap.show()}},onHide:function(){this.wrap.hide()}});Ext.override(Ext.PagingToolbar,{onRender:function(C,B){Ext.PagingToolbar.superclass.onRender.call(this,C,B);this.first=this.addButton({tooltip:this.firstText,iconCls:"x-tbar-page-first",disabled:true,handler:this.onClick.createDelegate(this,["first"])});this.prev=this.addButton({tooltip:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.onClick.createDelegate(this,["prev"])});this.addSeparator();this.add(this.beforePageText);this.field=Ext.get(this.addDom({tag:"input",type:"text",size:"3",value:"1",cls:"x-tbar-page-number"}).el);this.field.on("keydown",this.onPagingKeydown,this);this.field.on("focus",function(){this.dom.select()});this.afterTextEl=this.addText(String.format(this.afterPageText,1));this.field.setHeight(18);this.addSeparator();this.next=this.addButton({tooltip:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.onClick.createDelegate(this,["next"])});this.last=this.addButton({tooltip:this.lastText,iconCls:"x-tbar-page-last",disabled:true,handler:this.onClick.createDelegate(this,["last"])});this.loading=this.addButton({hidden:true,tooltip:this.refreshText,iconCls:"x-tbar-loading",handler:this.onClick.createDelegate(this,["refresh"])});if(this.displayInfo){this.displayEl=Ext.fly(this.el.dom).createChild({cls:"x-paging-info"})}if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}}});Array.prototype.contains=function(B){return this.indexOf(B)!==-1};Ext.namespace("Ext.ux");Ext.ux.DDView=function(C){if(!C.itemSelector){var B=C.tpl;if(this.classRe.test(B)){C.tpl=B.replace(this.classRe,"class=$1x-combo-list-item $2$1")}else{C.tpl=B.replace(this.tagRe,'$1 class="x-combo-list-item" $2')}C.itemSelector=".x-combo-list-item"}Ext.ux.DDView.superclass.constructor.call(this,Ext.apply(C,{border:false}))};Ext.extend(Ext.ux.DDView,Ext.DataView,{sortDir:"ASC",isFormField:true,classRe:/class=(['"])(.*)\1/,tagRe:/(<\w*)(.*?>)/,reset:Ext.emptyFn,clearInvalid:Ext.form.Field.prototype.clearInvalid,msgTarget:"qtip",afterRender:function(){Ext.ux.DDView.superclass.afterRender.call(this);if(this.dragGroup){this.setDraggable(this.dragGroup.split(","))}if(this.dropGroup){this.setDroppable(this.dropGroup.split(","))}if(this.deletable){this.setDeletable()}this.isDirtyFlag=false;this.addEvents("drop")},validate:function(){return true},destroy:function(){this.purgeListeners();this.getEl().removeAllListeners();this.getEl().remove();if(this.dragZone){if(this.dragZone.destroy){this.dragZone.destroy()}}if(this.dropZone){if(this.dropZone.destroy){this.dropZone.destroy()}}},getName:function(){return this.name},setValue:function(B){if(!this.store){throw"DDView.setValue(). DDView must be constructed with a valid Store"}var C={};C[this.store.reader.meta.root]=B?[].concat(B):[];this.store.proxy=new Ext.data.MemoryProxy(C);this.store.load()},getValue:function(){var B="(";this.store.each(function(C){B+=C.id+","});return B.substr(0,B.length-1)+")"},getIds:function(){var C=0,B=new Array(this.store.getCount());this.store.each(function(D){B[C++]=D.id});return B},isDirty:function(){return this.isDirtyFlag},getTargetFromEvent:function(C){var B=C.getTarget();while((B!==null)&&(B.parentNode!=this.el.dom)){B=B.parentNode}if(!B){B=this.el.dom.lastChild||this.el.dom}return B},getDragData:function(E){var D=this.findItemFromChild(E.getTarget());if(D){if(!this.isSelected(D)){delete this.ignoreNextClick;this.onItemClick(D,this.indexOf(D),E);this.ignoreNextClick=true}var C={sourceView:this,viewNodes:[],records:[],copy:this.copy||(this.allowCopy&&E.ctrlKey)};if(this.getSelectionCount()==1){var B=this.getSelectedIndexes()[0];var F=this.getNode(B);C.viewNodes.push(C.ddel=F);C.records.push(this.store.getAt(B));C.repairXY=Ext.fly(F).getXY()}else{C.ddel=document.createElement("div");C.ddel.className="multi-proxy";this.collectSelection(C)}return C}return false},getRepairXY:function(B){return this.dragData.repairXY},collectSelection:function(C){C.repairXY=Ext.fly(this.getSelectedNodes()[0]).getXY();if(this.preserveSelectionOrder===true){Ext.each(this.getSelectedIndexes(),function(D){var F=this.getNode(D);var E=F.cloneNode(true);E.id=Ext.id();C.ddel.appendChild(E);C.records.push(this.store.getAt(D));C.viewNodes.push(F)},this)}else{var B=0;this.store.each(function(E){if(this.isSelected(B)){var F=this.getNode(B);var D=F.cloneNode(true);D.id=Ext.id();C.ddel.appendChild(D);C.records.push(this.store.getAt(B));C.viewNodes.push(F)}B++},this)}},setDraggable:function(B){if(B instanceof Array){Ext.each(B,this.setDraggable,this);return}if(this.dragZone){this.dragZone.addToGroup(B)}else{this.dragZone=new Ext.dd.DragZone(this.getEl(),{containerScroll:true,ddGroup:B});if(!this.multiSelect){this.singleSelect=true}this.dragZone.getDragData=this.getDragData.createDelegate(this);this.dragZone.getRepairXY=this.getRepairXY;this.dragZone.onEndDrag=this.onEndDrag}},setDroppable:function(B){if(B instanceof Array){Ext.each(B,this.setDroppable,this);return}if(this.dropZone){this.dropZone.addToGroup(B)}else{this.dropZone=new Ext.dd.DropZone(this.getEl(),{owningView:this,containerScroll:true,ddGroup:B});this.dropZone.getTargetFromEvent=this.getTargetFromEvent.createDelegate(this);this.dropZone.onNodeEnter=this.onNodeEnter.createDelegate(this);this.dropZone.onNodeOver=this.onNodeOver.createDelegate(this);this.dropZone.onNodeOut=this.onNodeOut.createDelegate(this);this.dropZone.onNodeDrop=this.onNodeDrop.createDelegate(this)}},getDropPoint:function(E,H,C){if(H==this.el.dom){return"above"}var D=Ext.lib.Dom.getY(H),B=D+H.offsetHeight;var G=D+(B-D)/2;var F=Ext.lib.Event.getPageY(E);if(F<=G){return"above"}else{return"below"}},isValidDropPoint:function(C,E,B){if(!B.viewNodes||(B.viewNodes.length!=1)){return true}var D=B.viewNodes[0];if(D==E){return false}if((C=="below")&&(E.nextSibling==D)){return false}if((C=="above")&&(E.previousSibling==D)){return false}return true},onNodeEnter:function(E,B,D,C){if(this.highlightColor&&(C.sourceView!=this)){this.el.highlight(this.highlightColor)}return false},onNodeOver:function(H,B,G,E){var C=this.dropNotAllowed;var F=this.getDropPoint(G,H,B);if(this.isValidDropPoint(F,H,E)){if(this.appendOnly||this.sortField){return"x-tree-drop-ok-below"}if(F){var D;if(F=="above"){C=H.previousSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-above";D="x-view-drag-insert-above"}else{C=H.nextSibling?"x-tree-drop-ok-between":"x-tree-drop-ok-below";D="x-view-drag-insert-below"}if(this.lastInsertClass!=D){Ext.fly(H).replaceClass(this.lastInsertClass,D);this.lastInsertClass=D}}}return C},onNodeOut:function(E,B,D,C){this.removeDropIndicators(E)},onNodeDrop:function(D,J,H,F){if(this.fireEvent("drop",this,D,J,H,F)===false){return false}var K=this.getDropPoint(H,D,J);var E=(this.appendOnly||(D==this.el.dom))?this.store.getCount():D.viewIndex;if(K=="below"){E++}if(F.sourceView==this){if(K=="below"){if(F.viewNodes[0]==D){F.viewNodes.shift()}}else{if(F.viewNodes[F.viewNodes.length-1]==D){F.viewNodes.pop()}}if(!F.viewNodes.length){return false}if(E>this.store.indexOf(F.records[0])){E--}}if(F.node instanceof Ext.tree.TreeNode){var B=F.node.getOwnerTree().recordFromNode(F.node);if(B){F.records=[B]}}if(!F.records){alert("Programming problem. Drag data contained no Records");return false}for(var G=0;G<F.records.length;G++){var B=F.records[G];var C=this.store.getById(B.id);if(C&&(J!=this.dragZone)){if(!this.allowDup&&!this.allowTrash){Ext.fly(this.getNode(this.store.indexOf(C))).frame("red",1);return true}var I=new Ext.data.Record();B.id=I.id;delete I}if(F.copy){this.store.insert(E++,B.copy())}else{if(F.sourceView){F.sourceView.isDirtyFlag=true;F.sourceView.store.remove(B)}if(!this.allowTrash){this.store.insert(E++,B)}}if(this.sortField){this.store.sort(this.sortField,this.sortDir)}this.isDirtyFlag=true}this.dragZone.cachedTarget=null;return true},onEndDrag:function(B,C){var D=Ext.get(this.dragData.ddel);if(D&&D.hasClass("multi-proxy")){D.remove()}},removeDropIndicators:function(B){if(B){Ext.fly(B).removeClass(["x-view-drag-insert-above","x-view-drag-insert-left","x-view-drag-insert-right","x-view-drag-insert-below"]);this.lastInsertClass="_noclass"}},setDeletable:function(B){if(!this.singleSelect&&!this.multiSelect){this.singleSelect=true}var C=this.getContextMenu();this.contextMenu.on("itemclick",function(D){switch(D.id){case"delete":this.remove(this.getSelectedIndexes());break}},this);this.contextMenu.add({icon:B||AU.resolveUrl("/images/delete.gif"),id:"delete",text:AU.getMessage("deleteItem")})},getContextMenu:function(){if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({id:this.id+"-contextmenu"});this.el.on("contextmenu",this.showContextMenu,this)}return this.contextMenu},disableContextMenu:function(){if(this.contextMenu){this.el.un("contextmenu",this.showContextMenu,this)}},showContextMenu:function(C,B){B=this.findItemFromChild(C.getTarget());if(B){C.stopEvent();this.select(this.getNode(B),this.multiSelect&&C.ctrlKey,true);this.contextMenu.showAt(C.getXY())}},remove:function(C){C=[].concat(C);for(var B=0;B<C.length;B++){var D=this.store.getAt(C[B]);this.store.remove(D)}},onDblClick:function(F){var E=this.findItemFromChild(F.getTarget());if(E){if(this.fireEvent("dblclick",this,this.indexOf(E),E,F)===false){return false}if(this.dragGroup){var B=Ext.dd.DragDropMgr.getRelated(this.dragZone,true);while(B.contains(this.dropZone)){B.remove(this.dropZone)}if((B.length==1)&&(B[0].owningView)){this.dragZone.cachedTarget=null;var C=Ext.get(B[0].getEl());var D=C.getBox(true);B[0].onNodeDrop(C.dom,{target:C.dom,xy:[D.x,D.y+D.height-1]},null,this.getDragData(F))}}}},onItemClick:function(C,B,D){if(this.ignoreNextClick){delete this.ignoreNextClick;return}if(this.fireEvent("beforeclick",this,B,C,D)===false){return false}if(this.multiSelect||this.singleSelect){if(this.multiSelect&&D.shiftKey&&this.lastSelection){this.select(this.getNodes(this.indexOf(this.lastSelection),B),false)}else{if(this.isSelected(C)&&D.ctrlKey){this.deselect(C)}else{this.deselect(C);this.select(C,this.multiSelect&&D.ctrlKey);this.lastSelection=C}}D.preventDefault()}return true}});Ext.ux.Multiselect=Ext.extend(Ext.form.Field,{store:null,dataFields:[],data:[],width:100,height:100,displayField:0,valueField:1,allowBlank:true,minLength:0,maxLength:Number.MAX_VALUE,blankText:Ext.form.TextField.prototype.blankText,minLengthText:"Minimum {0} item(s) required",maxLengthText:"Maximum {0} item(s) allowed",copy:false,allowDup:false,allowTrash:false,legend:null,focusClass:undefined,delimiter:",",view:null,dragGroup:null,dropGroup:null,tbar:null,appendOnly:false,sortField:null,sortDir:"ASC",defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.Multiselect.superclass.initComponent.call(this);this.addEvents({dblclick:true,click:true,change:true,drop:true})},onRender:function(F,C){var B,D,E;Ext.ux.Multiselect.superclass.onRender.call(this,F,C);D="ux-mselect";B=new Ext.form.FieldSet({renderTo:this.el,title:this.legend,height:this.height,width:this.width,style:"padding:1px;",tbar:this.tbar});if(!this.legend){B.el.down("."+B.headerCls).remove()}B.body.addClass(D);E='<tpl for="."><div class="'+D+"-item";if(Ext.isIE||Ext.isIE7){E+='" unselectable=on'}else{E+=' x-unselectable"'}E+=">{"+this.displayField+"}</div></tpl>";if(!this.store){this.store=new Ext.data.SimpleStore({fields:this.dataFields,data:this.data})}this.view=new Ext.ux.DDView({multiSelect:true,store:this.store,selectedClass:D+"-selected",tpl:E,allowDup:this.allowDup,copy:this.copy,allowTrash:this.allowTrash,dragGroup:this.dragGroup,dropGroup:this.dropGroup,itemSelector:"."+D+"-item",isFormField:false,applyTo:B.body,appendOnly:this.appendOnly,sortField:this.sortField,sortDir:this.sortDir});B.add(this.view);this.view.on("click",this.onViewClick,this);this.view.on("beforeClick",this.onViewBeforeClick,this);this.view.on("dblclick",this.onViewDblClick,this);this.view.on("drop",function(I,L,H,K,J){return this.fireEvent("drop",I,L,H,K,J)},this);this.hiddenName=this.name;var G={tag:"input",type:"hidden",value:"",name:this.name};if(this.isFormField){this.hiddenField=this.el.createChild(G)}else{this.hiddenField=Ext.get(document.body).createChild(G)}B.doLayout()},initValue:Ext.emptyFn,onViewClick:function(E,C,D,F){var B=this.preClickSelections.indexOf(C);if(B!=-1){this.preClickSelections.splice(B,1);this.view.clearSelections(true);this.view.select(this.preClickSelections)}this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value);this.hiddenField.dom.value=this.getValue();this.fireEvent("click",this,F);this.validate()},onViewBeforeClick:function(D,B,C,E){this.preClickSelections=this.view.getSelectedIndexes();if(this.disabled){return false}},onViewDblClick:function(D,B,C,E){return this.fireEvent("dblclick",D,B,C,E)},getValue:function(B){var E=[];var D=this.view.getSelectedIndexes();if(D.length==0){return""}for(var C=0;C<D.length;C++){E.push(this.store.getAt(D[C]).get(((B!=null)?B:this.valueField)))}return E.join(this.delimiter)},setValue:function(B){var C;var E=[];this.view.clearSelections();this.hiddenField.dom.value="";if(!B||(B=="")){return}if(!(B instanceof Array)){B=B.split(this.delimiter)}for(var D=0;D<B.length;D++){C=this.view.store.indexOf(this.view.store.query(this.valueField,new RegExp("^"+B[D]+"$","i")).itemAt(0));E.push(C)}this.view.select(E);this.hiddenField.dom.value=this.getValue();this.validate()},reset:function(){this.setValue("")},getRawValue:function(B){var C=this.getValue(B);if(C.length){C=C.split(this.delimiter)}else{C=[]}return C},setRawValue:function(B){setValue(B)},validateValue:function(B){if(B.length<1){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}if(B.length<this.minLength){this.markInvalid(String.format(this.minLengthText,this.minLength));return false}if(B.length>this.maxLength){this.markInvalid(String.format(this.maxLengthText,this.maxLength));return false}return true}});Ext.reg("multiselect",Ext.ux.Multiselect);Ext.ux.ItemSelector=Ext.extend(Ext.form.Field,{msWidth:200,msHeight:300,hideNavIcons:false,imagePath:"",iconUp:"up2.gif",iconDown:"down2.gif",iconLeft:"left2.gif",iconRight:"right2.gif",iconTop:"top2.gif",iconBottom:"bottom2.gif",drawUpIcon:true,drawDownIcon:true,drawLeftIcon:true,drawRightIcon:true,drawTopIcon:true,drawBotIcon:true,fromStore:null,toStore:null,fromData:null,toData:null,displayField:0,valueField:1,switchToFrom:false,allowDup:false,focusClass:undefined,delimiter:",",readOnly:false,toLegend:null,fromLegend:null,toSortField:null,fromSortField:null,toSortDir:"ASC",fromSortDir:"ASC",toTBar:null,fromTBar:null,bodyStyle:null,border:false,defaultAutoCreate:{tag:"div"},initComponent:function(){Ext.ux.ItemSelector.superclass.initComponent.call(this);this.addEvents({rowdblclick:true,change:true})},onRender:function(E,B){Ext.ux.ItemSelector.superclass.onRender.call(this,E,B);this.fromMultiselect=new Ext.ux.Multiselect({legend:this.fromLegend,delimiter:this.delimiter,allowDup:this.allowDup,copy:this.allowDup,allowTrash:this.allowDup,dragGroup:this.readOnly?null:"drop2-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,dataFields:this.dataFields,data:this.fromData,displayField:this.displayField,valueField:this.valueField,store:this.fromStore,isFormField:false,tbar:this.fromTBar,appendOnly:true,sortField:this.fromSortField,sortDir:this.fromSortDir});this.fromMultiselect.on("dblclick",this.onRowDblClick,this);if(!this.toStore){this.toStore=new Ext.data.SimpleStore({fields:this.dataFields,data:this.toData})}this.toStore.on("add",this.valueChanged,this);this.toStore.on("remove",this.valueChanged,this);this.toStore.on("load",this.valueChanged,this);this.toMultiselect=new Ext.ux.Multiselect({legend:this.toLegend,delimiter:this.delimiter,allowDup:this.allowDup,dragGroup:this.readOnly?null:"drop1-"+this.el.dom.id,dropGroup:this.readOnly?null:"drop2-"+this.el.dom.id+",drop1-"+this.el.dom.id,width:this.msWidth,height:this.msHeight,displayField:this.displayField,valueField:this.valueField,store:this.toStore,isFormField:false,tbar:this.toTBar,sortField:this.toSortField,sortDir:this.toSortDir});this.toMultiselect.on("dblclick",this.onRowDblClick,this);var H=new Ext.Panel({bodyStyle:this.bodyStyle,border:this.border,layout:"table",layoutConfig:{columns:3}});H.add(this.switchToFrom?this.toMultiselect:this.fromMultiselect);var D=new Ext.Panel({header:false});H.add(D);H.add(this.switchToFrom?this.fromMultiselect:this.toMultiselect);H.render(this.el);D.el.down("."+D.bwrapCls).remove();if(this.imagePath!=""&&this.imagePath.charAt(this.imagePath.length-1)!="/"){this.imagePath+="/"}this.iconUp=this.imagePath+(this.iconUp||"up2.gif");this.iconDown=this.imagePath+(this.iconDown||"down2.gif");this.iconLeft=this.imagePath+(this.iconLeft||"left2.gif");this.iconRight=this.imagePath+(this.iconRight||"right2.gif");this.iconTop=this.imagePath+(this.iconTop||"top2.gif");this.iconBottom=this.imagePath+(this.iconBottom||"bottom2.gif");var G=D.getEl();if(!this.toSortField){this.toTopIcon=G.createChild({tag:"img",src:this.iconTop,style:{cursor:"pointer",margin:"2px"}});G.createChild({tag:"br"});this.upIcon=G.createChild({tag:"img",src:this.iconUp,style:{cursor:"pointer",margin:"2px"}});G.createChild({tag:"br"})}this.addIcon=G.createChild({tag:"img",src:this.switchToFrom?this.iconLeft:this.iconRight,style:{cursor:"pointer",margin:"2px"}});G.createChild({tag:"br"});this.removeIcon=G.createChild({tag:"img",src:this.switchToFrom?this.iconRight:this.iconLeft,style:{cursor:"pointer",margin:"2px"}});G.createChild({tag:"br"});if(!this.toSortField){this.downIcon=G.createChild({tag:"img",src:this.iconDown,style:{cursor:"pointer",margin:"2px"}});G.createChild({tag:"br"});this.toBottomIcon=G.createChild({tag:"img",src:this.iconBottom,style:{cursor:"pointer",margin:"2px"}})}if(!this.readOnly){if(!this.toSortField){this.toTopIcon.on("click",this.toTop,this);this.upIcon.on("click",this.up,this);this.downIcon.on("click",this.down,this);this.toBottomIcon.on("click",this.toBottom,this)}this.addIcon.on("click",this.fromTo,this);this.removeIcon.on("click",this.toFrom,this)}if(!this.drawUpIcon||this.hideNavIcons){this.upIcon.dom.style.display="none"}if(!this.drawDownIcon||this.hideNavIcons){this.downIcon.dom.style.display="none"}if(!this.drawLeftIcon||this.hideNavIcons){this.addIcon.dom.style.display="none"}if(!this.drawRightIcon||this.hideNavIcons){this.removeIcon.dom.style.display="none"}if(!this.drawTopIcon||this.hideNavIcons){this.toTopIcon.dom.style.display="none"}if(!this.drawBotIcon||this.hideNavIcons){this.toBottomIcon.dom.style.display="none"}var C=H.body.first();this.el.setWidth(H.body.first().getWidth());H.body.removeClass();this.hiddenName=this.name;var F={tag:"input",type:"hidden",value:"",name:this.name};this.hiddenField=this.el.createChild(F);this.valueChanged(this.toStore)},initValue:Ext.emptyFn,toTop:function(){var D=this.toMultiselect.view.getSelectedIndexes();var B=[];if(D.length>0){D.sort();for(var C=0;C<D.length;C++){record=this.toMultiselect.view.store.getAt(D[C]);B.push(record)}D=[];for(var C=B.length-1;C>-1;C--){record=B[C];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.insert(0,record);D.push(((B.length-1)-C))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(D)},toBottom:function(){var D=this.toMultiselect.view.getSelectedIndexes();var B=[];if(D.length>0){D.sort();for(var C=0;C<D.length;C++){record=this.toMultiselect.view.store.getAt(D[C]);B.push(record)}D=[];for(var C=0;C<B.length;C++){record=B[C];this.toMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);D.push((this.toMultiselect.view.store.getCount())-(B.length-C))}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(D)},up:function(){var B=null;var D=this.toMultiselect.view.getSelectedIndexes();D.sort();var E=[];if(D.length>0){for(var C=0;C<D.length;C++){B=this.toMultiselect.view.store.getAt(D[C]);if((D[C]-1)>=0){this.toMultiselect.view.store.remove(B);this.toMultiselect.view.store.insert(D[C]-1,B);E.push(D[C]-1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(E)}},down:function(){var B=null;var D=this.toMultiselect.view.getSelectedIndexes();D.sort();D.reverse();var E=[];if(D.length>0){for(var C=0;C<D.length;C++){B=this.toMultiselect.view.store.getAt(D[C]);if((D[C]+1)<this.toMultiselect.view.store.getCount()){this.toMultiselect.view.store.remove(B);this.toMultiselect.view.store.insert(D[C]+1,B);E.push(D[C]+1)}}this.toMultiselect.view.refresh();this.toMultiselect.view.select(E)}},fromTo:function(){var E=this.fromMultiselect.view.getSelectedIndexes();var C=[];if(E.length>0){for(var D=0;D<E.length;D++){record=this.fromMultiselect.view.store.getAt(E[D]);C.push(record)}if(!this.allowDup){E=[]}for(var D=0;D<C.length;D++){record=C[D];if(this.allowDup){var B=new Ext.data.Record();record.id=B.id;delete B;this.toMultiselect.view.store.add(record)}else{this.fromMultiselect.view.store.remove(record);this.toMultiselect.view.store.add(record);E.push((this.toMultiselect.view.store.getCount()-1))}}}this.toMultiselect.view.refresh();this.fromMultiselect.view.refresh();if(this.toSortField){this.toMultiselect.store.sort(this.toSortField,this.toSortDir)}if(this.allowDup){this.fromMultiselect.view.select(E)}else{this.toMultiselect.view.select(E)}},toFrom:function(){var D=this.toMultiselect.view.getSelectedIndexes();var B=[];if(D.length>0){for(var C=0;C<D.length;C++){record=this.toMultiselect.view.store.getAt(D[C]);B.push(record)}D=[];for(var C=0;C<B.length;C++){record=B[C];this.toMultiselect.view.store.remove(record);if(!this.allowDup){this.fromMultiselect.view.store.add(record);D.push((this.fromMultiselect.view.store.getCount()-1))}}}this.fromMultiselect.view.refresh();this.toMultiselect.view.refresh();if(this.fromSortField){this.fromMultiselect.store.sort(this.fromSortField,this.fromSortDir)}this.fromMultiselect.view.select(D)},valueChanged:function(D){var B=null;var C=[];for(var E=0;E<D.getCount();E++){B=D.getAt(E);C.push(B.get(this.valueField))}this.hiddenField.dom.value=C.join(this.delimiter);this.fireEvent("change",this,this.getValue(),this.hiddenField.dom.value)},getValue:function(){return this.hiddenField.dom.value},onRowDblClick:function(D,B,C,E){return this.fireEvent("rowdblclick",D,B,C,E)},reset:function(){range=this.toMultiselect.store.getRange();this.toMultiselect.store.removeAll();if(!this.allowDup){this.fromMultiselect.store.add(range);this.fromMultiselect.store.sort(this.displayField,"ASC")}this.valueChanged(this.toMultiselect.store)}});Ext.reg("itemselector",Ext.ux.ItemSelector);Ext.namespace("Ext.ux.Andrie");Ext.ux.Andrie.pPageSize=function(B){Ext.apply(this,B)};Ext.extend(Ext.ux.Andrie.pPageSize,Ext.util.Observable,{beforeText:"Show",afterText:"items",addBefore:"-",addAfter:null,dynamic:false,variations:[5,10,20,50,100,200,500,1000],comboCfg:undefined,init:function(B){this.pagingToolbar=B;this.pagingToolbar.pageSizeCombo=this;this.pagingToolbar.setPageSize=this.setPageSize.createDelegate(this);this.pagingToolbar.getPageSize=function(){return this.pageSize};this.pagingToolbar.on("render",this.onRender,this)},addSize:function(B){if(B>0){this.sizes.push([B])}},updateStore:function(){if(this.dynamic){var C=this.pagingToolbar.pageSize,F;C=(C>0)?C:1;this.sizes=[];var D=this.variations;for(var E=0,B=D.length;E<B;E++){this.addSize(C-D[D.length-1-E])}this.addToStore(C);for(var E=0,B=D.length;E<B;E++){this.addSize(C+D[E])}}else{if(!this.staticSizes){this.sizes=[];var D=this.variations;var C=0;for(var E=0,B=D.length;E<B;E++){this.addSize(C+D[E])}this.staticSizes=this.sizes.slice(0)}else{this.sizes=this.staticSizes.slice(0)}}this.combo.store.loadData(this.sizes);this.combo.collapse();this.combo.setValue(this.pagingToolbar.pageSize)},setPageSize:function(F,I){var J=this.pagingToolbar;this.combo.collapse();F=parseInt(F)||parseInt(this.combo.getValue());F=(F>0)?F:1;if(F==J.pageSize){return}else{if(F<J.pageSize){J.pageSize=F;var B=Math.round(J.cursor/F)+1;var H=(B-1)*F;var G=J.store;if(H>G.getTotalCount()){this.pagingToolbar.pageSize=F;this.pagingToolbar.doLoad(H-F)}else{G.suspendEvents();for(var C=0,D=H-J.cursor;C<D;C++){G.remove(G.getAt(0))}while(G.getCount()>F){G.remove(G.getAt(G.getCount()-1))}G.resumeEvents();G.fireEvent("datachanged",G);J.cursor=H;var E=J.getPageData();J.afterTextEl.el.innerHTML=String.format(J.afterPageText,E.pages);J.field.dom.value=B;J.first.setDisabled(B==1);J.prev.setDisabled(B==1);J.next.setDisabled(B==E.pages);J.last.setDisabled(B==E.pages);J.updateInfo()}}else{this.pagingToolbar.pageSize=F;this.pagingToolbar.doLoad(Math.floor(this.pagingToolbar.cursor/this.pagingToolbar.pageSize)*this.pagingToolbar.pageSize)}}this.updateStore()},onRender:function(){this.combo=Ext.ComponentMgr.create(Ext.applyIf(this.comboCfg||{},{store:new Ext.data.SimpleStore({fields:["pageSize"],data:[]}),displayField:"pageSize",valueField:"pageSize",mode:"local",triggerAction:"all",width:50,xtype:"combo"}));this.combo.on("select",this.setPageSize,this);this.updateStore();if(this.addBefore){this.pagingToolbar.add(this.addBefore)}if(this.beforeText){this.pagingToolbar.add(this.beforeText)}this.pagingToolbar.add(this.combo);if(this.afterText){this.pagingToolbar.add(this.afterText)}if(this.addAfter){this.pagingToolbar.add(this.addAfter)}}});Ext.grid.RowExpander=function(B){Ext.apply(this,B);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}};Ext.extend(Ext.grid.RowExpander,Ext.util.Observable,{header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowClass:function(B,F,E,D){E.cols=E.cols-1;var C=this.bodyContent[B.id];if(!C&&!this.lazyRender){C=this.getBodyContent(B,F)}if(C){E.body=C}return this.state[B.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(C){this.grid=C;var B=C.getView();B.getRowClass=this.getRowClass.createDelegate(this);B.enableRowBody=true;C.on("render",function(){B.mainBody.on("mousedown",this.onMouseDown,this)},this)},getBodyContent:function(B,C){if(!this.enableCaching){return this.tpl.apply(B.data)}var D=this.bodyContent[B.id];if(!D){D=this.tpl.apply(B.data);this.bodyContent[B.id]=D}return D},onMouseDown:function(C,B){if(B.className=="x-grid3-row-expander"){C.stopEvent();var D=C.getTarget(".x-grid3-row");this.toggleRow(D)}},renderer:function(C,D,B){D.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(C,B,D){if(this.fireEvent("beforeexpand",this,C,B,D)!==false){if(this.tpl&&this.lazyRender){B.innerHTML=this.getBodyContent(C,D)}return true}else{return false}},toggleRow:function(B){if(typeof B=="number"){B=this.grid.view.getRow(B)}this[Ext.fly(B).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](B)},expandRow:function(D){if(typeof D=="number"){D=this.grid.view.getRow(D)}var C=this.grid.store.getAt(D.rowIndex);var B=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",D);if(this.beforeExpand(C,B,D.rowIndex)){this.state[C.id]=true;Ext.fly(D).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,C,B,D.rowIndex)}},collapseRow:function(D){if(typeof D=="number"){D=this.grid.view.getRow(D)}var C=this.grid.store.getAt(D.rowIndex);var B=Ext.fly(D).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,C,B,D.rowIndex)!==false){this.state[C.id]=false;Ext.fly(D).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,C,B,D.rowIndex)}}});Ext.BLANK_IMAGE_URL="/xwiki/skins/curriki8/extjs/resources/images/default/s.gif";Ext.Ajax.defaultHeaders={Accept:"application/json","Content-Type":"application/json; charset=utf-8;"};Ext.Ajax.disableCaching=false;if(!("console"in window)||!("firebug"in console)){var names=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var i=0;i<names.length;++i){window.console[names[i]]=Ext.emptyFn}}console.log("initing Curriki");Ext.onReady(function(){Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{showDelay:1000,hideDelay:0})});Ext.ns("Curriki");Ext.ns("Curriki.module");Ext.onReady(function(){Curriki.loadingMask=new Ext.LoadMask(Ext.getBody(),{msg:_("loading.loading_msg")});Ext.Ajax.on("beforerequest",function(C,B){console.log("beforerequest",C,B);Curriki.showLoading(B.waitMsg)});Ext.Ajax.on("requestcomplete",function(D,B,C){console.log("requestcomplete",D,B,C);Curriki.hideLoading()});Ext.Ajax.on("requestexception",function(D,B,C){console.log("requestexception",D,B,C);Curriki.hideLoading()})});Curriki.id=function(B){return Ext.id("",B+":")};Curriki.showLoading=function(B){if(!Ext.isEmpty(Curriki.loadingMask)){B=B||"loading.loading_msg";Curriki.loadingMask.msg=_(B);Curriki.loadingMask.enable();Curriki.loadingMask.show()}};Curriki.hideLoading=function(){if(!Ext.isEmpty(Curriki.loadingMask)){Curriki.loadingMask.hide();Curriki.loadingMask.disable()}};Curriki.logView=function(B){if(window.pageTracker){pageTracker._trackPageview(B)}else{console.info("Would track: ",B)}};Curriki.start=function(callback){console.log("Start Callback: ",callback);var args={};if("object"===typeof callback){if(callback.args){args=callback.args}if(callback.callback){callback=callback.callback}else{if(callback.module){callback=callback.module}}}if("string"===typeof callback){var module=eval("(Curriki.module."+callback.toLowerCase()+")");if(module&&"function"===typeof module.init){module.init(args);if("function"===typeof module.start){callback=module.start}else{callback=Ext.emptyFn}}else{switch(callback){default:callback=Ext.emptyFn;break}}}if("function"===typeof callback){callback(args)}};Curriki.init=function(B){console.log("Curriki.init: ",B);if(Ext.isEmpty(Curriki.initialized)){Curriki.data.user.GetUserinfo(function(){Curriki.start(B)});Curriki.initialized=true}else{Curriki.start(B)}};Ext.ns("Curriki.data.user");Curriki.data.user={me:{username:"XWiki.XWikiGuest",fullname:"Guest"},collections:[],groups:[],collectionChildren:[],groupChildren:[],json_prefix:"/xwiki/curriki/users/",user_try:0,GetUserinfo:function(B){this.user_try++;Ext.Ajax.request({url:this.json_prefix+"me",method:"GET",disableCaching:true,headers:{Accept:"application/json"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot get user information");if(this.user_try<5){this.GetUserinfo(B)}else{console.error("Cannot get user information",C,D);alert(_("add.servertimedout.message.text"))}}else{this.user_try=0;this.me=F;this.GetCollections(B)}},failure:function(C,D){console.error("Cannot get user information",C,D);alert(_("add.servertimedout.message.text"))}})},collection_try:0,GetCollections:function(B){this.collection_try++;Ext.Ajax.request({url:this.json_prefix+this.me.username+"/collections",method:"GET",disableCaching:true,headers:{Accept:"application/json"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot read user's collection information");if(this.collection_try<5){this.GetCollections(B)}else{console.error("Cannot get user's collection information",C,D);alert(_("add.servertimedout.message.text"))}}else{this.collection_try=0;this.collections=F;this.collectionChildren=this.CreateCollectionChildren();console.log("Collections: ",this.collectionChildren);this.GetGroups(B)}},failure:function(C,D){console.error("Cannot get user's collection information",C,D);alert(_("add.servertimedout.message.text"));this.collections=[];this.GetGroups(B)}})},group_try:0,GetGroups:function(B){Ext.Ajax.request({url:this.json_prefix+this.me.username+"/groups",method:"GET",disableCaching:true,headers:{Accept:"application/json"},scope:this,success:function(C,D){var E=C.responseText;var F=E.evalJSON(true);if(!F){console.warn("Cannot read user's group information");if(this.group_try<5){this.GetGroups(B)}else{throw{message:"GetUserinfo: Json object not found"};console.error("Cannot get user's group information",C,D);alert(_("add.servertimedout.message.text"))}}else{this.group_try=0;this.groups=F;this.groupChildren=this.CreateGroupChildren();B()}},failure:function(C,D){console.error("Cannot get user's group information",C,D);alert(_("add.servertimedout.message.text"));this.groups=[];B()}})},CreateCollectionChildren:function(){var B=[];this.collections.each(function(D){var E={id:D.collectionPage,text:D.displayTitle,qtip:D.description,cls:"resource-"+D.assetType,allowDrag:false,allowDrop:true};if(Ext.isArray(D.children)&&D.children.length>0){var C=[];D.children.each(function(G){var F={id:G.assetpage,order:G.order,text:G.displayTitle,qtip:G.description,cls:"ctv-resource resource-"+G.assetType,allowDrag:false,allowDrop:false};if("undefined"===typeof G.rights||!G.rights.view){F.text=_("resource.unviewable");F.qtip=undefined;F.disabled=true;F.leaf=true;F.cls=F.cls+" rights-unviewable"}else{if(G.assetType.search(/Composite$/)===-1){F.leaf=true}else{F.leaf=false;F.allowDrop=true;F.disallowDropping=(G.rights.edit?null:true)}}C.push(F)});E.children=C}else{E.leaf=false;E.children=[]}B.push(E)});return B},CreateGroupChildren:function(){var B=[];this.groups.each(function(C){if(C.editableCollectionCount>0){var D={id:C.groupSpace,currikiNodeType:"group",text:C.displayTitle,qtip:C.description,cls:"curriki-group",allowDrag:false,allowDrop:true,disallowDropping:true};B.push(D)}});return B}};Ext.ns("Curriki.data.ict");Curriki.data.ict.list=["activity_assignment","activity_exercise","activity_lab","activity_worksheet","activity_problemset","book_fiction","book_nonfiction","book_readings","book_textbook","curriculum_assessment","curriculum_course","curriculum_unit","curriculum_lp","curriculum_rubric","curriculum_scope","curriculum_standards","curriculum_studyguide","curriculum_syllabus","curriculum_tutorial","curriculum_workbook","resource_animation","resource_diagram","resource_glossary","resource_index","resource_photograph","resource_presentation","resource_collection","resource_script","resource_speech","resource_table","resource_template","resource_webcast","other"];Curriki.data.ict.data=[];Curriki.data.ict.list.each(function(B){Curriki.data.ict.data.push([B,_("XWiki.AssetClass_instructional_component2_"+B)])});Curriki.data.ict.store=new Ext.data.SimpleStore({fields:["id","ict"],data:Curriki.data.ict.data});Ext.ns("Curriki.data.el");Curriki.data.el.list=["prek","gr-k-2","gr-3-5","gr-6-8","gr-9-10","gr-11-12","college_and_beyond","professional_development","special_education","na"];Curriki.data.el.data=[];Curriki.data.el.list.each(function(B){Curriki.data.el.data.push({inputValue:B,boxLabel:_("XWiki.AssetClass_educational_level2_"+B)})});Ext.ns("Curriki.data.rights");Curriki.data.rights.list=["public","members","private"];Curriki.data.rights.initial=Curriki.data.rights.list[0];Curriki.data.rights.data=[];Curriki.data.rights.list.each(function(B){Curriki.data.rights.data.push({inputValue:B,boxLabel:_("XWiki.AssetClass_rights_"+B),checked:Curriki.data.rights.initial==B?true:false})});Ext.ns("Curriki.data.language");Curriki.data.language.list=["eng","ind","zho","nld","fra","deu","hin","ita","jpn","kor","nep","por","rus","spa"];Curriki.data.language.initial=Curriki.data.language.list[0];Curriki.data.language.data=[];Curriki.data.language.list.each(function(B){Curriki.data.language.data.push([B,_("XWiki.AssetClass_language_"+B)])});Curriki.data.language.store=new Ext.data.SimpleStore({fields:["id","language"],data:Curriki.data.language.data});Ext.ns("Curriki.data.licence");Curriki.data.licence.list=["Licences.CurrikiLicense","Licences.PublicDomain","Licences.CreativeCommonsAttributionNon-Commercial","Licences.CreativeCommonsAttributionNoDerivatives","Licences.CreativeCommonsAttributionNon-CommercialNoDerivatives","Licences.CreativeCommonsAttributionSharealike","Licences.CreativeCommonsAttributionNon-CommercialShareAlike"];Curriki.data.licence.initial=Curriki.data.licence.list[0];Curriki.data.licence.data=[];Curriki.data.licence.list.each(function(B){Curriki.data.licence.data.push([B,_("XWiki.AssetLicenseClass_licenseType2_"+B)])});Curriki.data.licence.store=new Ext.data.SimpleStore({fields:["id","licence"],data:Curriki.data.licence.data});Ext.ns("Curriki.data.fw_item");Curriki.data.fw_item.fwCheckListener=function(D,C){var B=Ext.getCmp("fw_items-validation");if(B){B.setValue(B.getValue()+(C?1:-1))}if(C){if("undefined"!==typeof D.parentNode){if(!D.parentNode.ui.isChecked()){D.parentNode.ui.toggleCheck()}}}else{if(Ext.isArray(D.childNodes)){D.childNodes.each(function(E){if(E.ui.isChecked()){E.ui.toggleCheck()}})}}};Curriki.data.fw_item.fwMap={TREEROOTNODE:[{id:"FW_masterFramework.WebHome",parent:""}],"FW_masterFramework.WebHome":[{id:"FW_masterFramework.Arts",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.VocationalEducation",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.Education&Teaching",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.EducationalTechnology",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.Health",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.Information&MediaLiteracy",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.LanguageArts",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.Mathematics",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.Science",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.SocialStudies",parent:"FW_masterFramework.WebHome"},{id:"FW_masterFramework.ForeignLanguages",parent:"FW_masterFramework.WebHome"}],"FW_masterFramework.Information&MediaLiteracy":[{id:"FW_masterFramework.EvaluatingSources",parent:"FW_masterFramework.Information&MediaLiteracy"},{id:"FW_masterFramework.MediaEthics",parent:"FW_masterFramework.Information&MediaLiteracy"},{id:"FW_masterFramework.OnlineSafety",parent:"FW_masterFramework.Information&MediaLiteracy"},{id:"FW_masterFramework.ResearchMethods",parent:"FW_masterFramework.Information&MediaLiteracy"}],"FW_masterFramework.SocialStudies":[{id:"FW_masterFramework.Anthropology",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Careers_5",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Civics",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.CurrentEvents",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Economics",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Entrepreneurship",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Geography",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.GlobalAwareness",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Government",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.History Local",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.PoliticalSystems",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Psychology",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Religion",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Research_0",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Sociology",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.StateHistory",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Technology_1",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.Thinking&ProblemSolving",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.UnitedStatesGovernment",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.UnitedStatesHistory",parent:"FW_masterFramework.SocialStudies"},{id:"FW_masterFramework.WorldHistory",parent:"FW_masterFramework.SocialStudies"}],"FW_masterFramework.Arts":[{id:"FW_masterFramework.Architecture",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.Careers",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.Dance",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.DramaDramatics",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.Film",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.History",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.Music",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.Photography",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.PopularCulture",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.Technology",parent:"FW_masterFramework.Arts"},{id:"FW_masterFramework.VisualArts",parent:"FW_masterFramework.Arts"}],"FW_masterFramework.EducationalTechnology":[{id:"FW_masterFramework.Careers_0",parent:"FW_masterFramework.EducationalTechnology"},{id:"FW_masterFramework.IntegratingTechnologyintotheClassroom",parent:"FW_masterFramework.EducationalTechnology"},{id:"FW_masterFramework.UsingMultimedia&theInternet",parent:"FW_masterFramework.EducationalTechnology"}],"FW_masterFramework.VocationalEducation":[{id:"FW_masterFramework.Agriculture_0",parent:"FW_masterFramework.VocationalEducation"},{id:"FW_masterFramework.Business",parent:"FW_masterFramework.VocationalEducation"},{id:"FW_masterFramework.Careers_6",parent:"FW_masterFramework.VocationalEducation"},{id:"FW_masterFramework.OccupationalHomeEconomics",parent:"FW_masterFramework.VocationalEducation"},{id:"FW_masterFramework.School-to-work",parent:"FW_masterFramework.VocationalEducation"},{id:"FW_masterFramework.Technology_2",parent:"FW_masterFramework.VocationalEducation"},{id:"FW_masterFramework.Trade&Industrial",parent:"FW_masterFramework.VocationalEducation"}],"FW_masterFramework.Health":[{id:"FW_masterFramework.BodySystems&Senses",parent:"FW_masterFramework.Health"},{id:"FW_masterFramework.Careers_1",parent:"FW_masterFramework.Health"},{id:"FW_masterFramework.EnvironmentalHealth",parent:"FW_masterFramework.Health"},{id:"FW_masterFramework.HumanSexuality",parent:"FW_masterFramework.Health"},{id:"FW_masterFramework.MentalEmotionalHealth",parent:"FW_masterFramework.Health"},{id:"FW_masterFramework.Nutrition",parent:"FW_masterFramework.Health"},{id:"FW_masterFramework.SafetySmokingSubstanceAbusePrevention",parent:"FW_masterFramework.Health"}],"FW_masterFramework.Education&Teaching":[{id:"FW_masterFramework.Accessibility",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.AdultEducation",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.BilingualEducation",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.ClassroomManagement",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.EarlyChildhoodEducation",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.EducationAdministration",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.EducationalFoundations",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.EducationalPsychology",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.InstructionalDesign",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.MeasurementEvaluation",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.Mentoring",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.MulticulturalEducation",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.StandardsAlignment",parent:"FW_masterFramework.Education&Teaching"},{id:"FW_masterFramework.TeachingTechniques",parent:"FW_masterFramework.Education&Teaching"}],"FW_masterFramework.ForeignLanguages":[{id:"FW_masterFramework.Alphabet",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.Careers_7",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.CulturalAwareness",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.Grammar",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.InformalEducation",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.Linguistics",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.ListeningComprehension",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.Reading",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.Speaking",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.Spelling",parent:"FW_masterFramework.ForeignLanguages"},{id:"FW_masterFramework.VocabularyWriting",parent:"FW_masterFramework.ForeignLanguages"}],"FW_masterFramework.Mathematics":[{id:"FW_masterFramework.Algebra",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Appliedmathematics",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Arithmetic",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Calculus",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Careers_3",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.DataAnalysis&Probability",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Equations",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Estimation",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Geometry",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Graphing",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Measurement",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.NumberSense&Operations",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Patterns",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.ProblemSolving",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Statistics",parent:"FW_masterFramework.Mathematics"},{id:"FW_masterFramework.Trigonometry",parent:"FW_masterFramework.Mathematics"}],"FW_masterFramework.Science":[{id:"FW_masterFramework.Agriculture",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Astronomy",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Biology",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Botany",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Careers_4",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Chemistry",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Earthscience",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Ecology",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Engineering",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Generalscience",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Geology",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.HistoryofScience",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.LifeSciences",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Meteorology",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.NaturalHistory",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Oceanography",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Paleontology",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.PhysicalSciences",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Physics",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.ProcessSkills",parent:"FW_masterFramework.Science"},{id:"FW_masterFramework.Technology_0",parent:"FW_masterFramework.Science"}],"FW_masterFramework.LanguageArts":[{id:"FW_masterFramework.Alphabet_0",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Careers_2",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Journalism",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Listening&Speaking",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Literature",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Phonics",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.ReadingComprehension",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Research",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Spelling_0",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.StoryTelling",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Vocabulary",parent:"FW_masterFramework.LanguageArts"},{id:"FW_masterFramework.Writing",parent:"FW_masterFramework.LanguageArts"}]};var fwItem="FW_masterFramework.WebHome";Curriki.data.fw_item.fwAddNode=function(D,E){var C={id:E,text:_("XWiki.AssetClass_fw_items_"+E),checked:false,listeners:{checkchange:Curriki.data.fw_item.fwCheckListener}};if("undefined"!==typeof D[E]){var B=[];D[E].each(function(F){B.push(Curriki.data.fw_item.fwAddNode(D,F.id))});C.children=B;C.cls="fw-item fw-item-parent"}else{C.leaf=true;C.cls="fw-item fw-item-bottom"}return C};Curriki.data.fw_item.fwChildren=Curriki.data.fw_item.fwAddNode(Curriki.data.fw_item.fwMap,"FW_masterFramework.WebHome").children;Ext.ns("Curriki.ui.component.asset");Curriki.ui.component.asset.getFwTree=function(){return{xtype:"treepanel",loader:new Ext.tree.TreeLoader({preloadChildren:true}),id:"fw_items-tree",useArrows:true,autoHeight:true,border:false,cls:"fw-tree",animate:true,enableDD:false,containerScroll:true,rootVisible:true,root:new Ext.tree.AsyncTreeNode({text:_("XWiki.AssetClass_fw_items_FW_masterFramework.WebHome"),id:"FW_masterFramework.WebHome",cls:"fw-item-top fw-item-parent fw-item",leaf:false,expanded:true,children:Curriki.data.fw_item.fwChildren})}};Ext.ns("Curriki.assets");Curriki.assets={json_prefix:"/xwiki/curriki/assets",CreateAsset:function(B,C,D){Ext.Ajax.request({url:this.json_prefix,method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{parent:B||"",publishSpace:C||""},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H||!H.assetPage){console.warn("Cannot create resource",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot create resource",E,F);alert(_("add.servertimedout.message.text"))}})},GetAssetInfo:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B,method:"GET",headers:{Accept:"application/json","Content-type":"application/json"},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot get resource metadata",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot get resource metadata",D,E);alert(_("add.servertimedout.message.text"))}})},GetMetadata:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/metadata",method:"GET",headers:{Accept:"application/json","Content-type":"application/json"},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot get resource metadata",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot get resource metadata",D,E);alert(_("add.servertimedout.message.text"))}})},SetMetadata:function(B,C,D){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/metadata",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:C,scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot set resource metadata",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot set resource metadata",E,F);alert(_("add.servertimedout.message.text"))}})},CreateExternal:function(C,B,D){Ext.Ajax.request({url:this.json_prefix+"/"+C+"/externals",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{link:B},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot create external link",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot create external link",E,F);alert(_("add.servertimedout.message.text"))}})},CreateSubasset:function(C,E,B,D){Ext.Ajax.request({url:this.json_prefix+"/"+C+"/subassets",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{page:E,order:B},scope:this,success:function(F,G){var H=F.responseText;var I=H.evalJSON(true);if(!I){console.warn("Cannot add subasset",F.responseText,G);alert(_("add.servertimedout.message.text"))}else{Curriki.data.user.GetCollections(function(){D(I)})}},failure:function(F,G){console.error("Cannot add subasset",F,G);alert(_("add.servertimedout.message.text"))}})},CreateFolder:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/subassets",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{collectionType:"folder"},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot create folder",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot create folder",D,E);alert(_("add.servertimedout.message.text"))}})},CreateCollection:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/subassets",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{collectionType:"collection"},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot create collection",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot create collection",D,E);alert(_("add.servertimedout.message.text"))}})},CreateVIDITalk:function(B,C,D){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/viditalks",method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{page:B,videoId:C},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot add video",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot add video",E,F);alert(_("add.servertimedout.message.text"))}})},Publish:function(B,C,D){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/published",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{space:C},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot publish resource",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot publish resource",E,F);alert(_("add.servertimedout.message.text"))}})},ReorderRootCollection:function(B,E,D,C,F){Ext.Ajax.request({url:"/xwiki/curriki/"+B+"/"+E+"/collections",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{original:D,wanted:C},scope:this,success:function(G,H){var I=G.responseText;var J=I.evalJSON(true);if(!J){console.warn("Cannot reorder",G.responseText,H)}else{F(J)}},failure:function(G,H){console.error("Cannot reorder",G,H);if(G.status==412){if(G.responseText.search(/ 107 [^ ]+ 101:/)!==-1){var I="mycurriki.collections.reorder.";if(B==="groups"){I="groups_curriculum_collections_reorder."}alert(_(I+"error"))}else{alert(_("add.servertimedout.message.text"))}}else{alert(_("add.servertimedout.message.text"))}}})},UnnominateAsset:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/unnominate",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot unnominate resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot unnominate resource",D,E);alert(_("add.servertimedout.message.text"))}})},NominateAsset:function(B,C,D){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/nominate",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{comments:C},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot nominate resource",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot nominate resource",E,F);alert(_("add.servertimedout.message.text"))}})},PartnerAsset:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/partner",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot set as Partner resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot set as Partner resource",D,E);alert(_("add.servertimedout.message.text"))}})},SetAsterixReview:function(B,D,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/assetManager",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{action:"setAsterixReview",asterixReviewValue:C},scope:this,success:function(E,F){var G=E.responseText;var H=G.evalJSON(true);if(!H){console.warn("Cannot set as Partner resource",E.responseText,F);alert(_("add.servertimedout.message.text"))}else{D(H)}},failure:function(E,F){console.error("Cannot execute the action",E,F);alert(_("add.servertimedout.message.text"))}})},RemoveAsterixReview:function(B,C){Ext.Ajax.request({url:this.json_prefix+"/"+B+"/assetManager",method:"PUT",headers:{Accept:"application/json","Content-type":"application/json"},jsonData:{action:"removeAsterixReview"},scope:this,success:function(D,E){var F=D.responseText;var G=F.evalJSON(true);if(!G){console.warn("Cannot set as Partner resource",D.responseText,E);alert(_("add.servertimedout.message.text"))}else{C(G)}},failure:function(D,E){console.error("Cannot execute the action",D,E);alert(_("add.servertimedout.message.text"))}})}};Ext.ns("Curriki.ui");Curriki.ui.InfoImg="/xwiki/skins/curriki8/icons/exclamation.png";Ext.ns("Curriki.ui.dialog");Curriki.ui.dialog.Base=Ext.extend(Ext.Window,{title:_("Untitled"),border:false,modal:true,width:634,minWidth:400,minHeight:100,maxHeight:575,autoScroll:false,constrain:true,collapsible:false,closable:false,resizable:false,shadow:false,defaults:{border:false},listeners:{afterlayout:function(C,B){if(this.afterlayout_maxheight){}else{if(C.getBox().height>C.maxHeight){C.setHeight(C.maxHeight);C.center();this.afterlayout_maxheight=true}else{C.setHeight("auto")}}}},initComponent:function(){Curriki.ui.dialog.Base.superclass.initComponent.call(this)}});Curriki.ui.dialog.Actions=Ext.extend(Curriki.ui.dialog.Base,{width:634,initComponent:function(){Curriki.ui.dialog.Actions.superclass.initComponent.call(this)}});Ext.reg("dialogueactions",Curriki.ui.dialog.Actions);Curriki.ui.dialog.Messages=Ext.extend(Curriki.ui.dialog.Base,{width:500,initComponent:function(){Curriki.ui.dialog.Messages.superclass.initComponent.call(this)}});Ext.reg("dialoguemessages",Curriki.ui.dialog.Messages);Curriki.ui.show=function(E,B){var D={xtype:E};Ext.apply(D,B);var C=Ext.ComponentMgr.create(D);C.show();Ext.ComponentMgr.register(C)};Ext.ns("Curriki.ui.treeLoader");Curriki.ui.treeLoader.Base=function(B){Curriki.ui.treeLoader.Base.superclass.constructor.call(this)};Ext.extend(Curriki.ui.treeLoader.Base,Ext.tree.TreeLoader,{dataUrl:"DYNAMICALLY DETERMINED",createNode:function(attr){console.log("createNode: ",attr);if("string"===typeof attr.id){var parent=Curriki.ui.treeLoader.Base.superclass.createNode.call(this,attr);console.log("createNode: parent",parent);return parent}var childInfo={id:attr.assetpage||attr.collectionPage,text:attr.displayTitle,qtip:attr.description,cls:"resource-"+attr.assetType,allowDrag:false,allowDrop:false};if(attr.rights&&!attr.rights.view){childInfo.text=_("add.chooselocation.resource_unavailable");childInfo.qtip=undefined;childInfo.disabled=true;childInfo.allowDrop=false;childInfo.leaf=true;childInfo.cls=childInfo.cls+" rights-unviewable"}else{if(attr.assetType&&attr.assetType.search(/Composite$/)===-1){childInfo.leaf=true}else{if(attr.assetType){childInfo.leaf=false;childInfo.allowDrop=(attr.rights&&attr.rights.edit)}}}Ext.apply(childInfo,attr);if(this.baseAttrs){Ext.applyIf(childInfo,this.baseAttrs)}if(this.applyLoader!==false){childInfo.loader=this}if(typeof attr.uiProvider=="string"){childInfo.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}console.log("createNode: End ",childInfo);return(childInfo.leaf?new Ext.tree.TreeNode(childInfo):new Ext.tree.AsyncTreeNode(childInfo))},requestData:function(B,C){if(B.attributes.currikiNodeType==="group"){this.dataUrl="/xwiki/curriki/groups/"+B.attributes.id+"/collections"}else{this.dataUrl="/xwiki/curriki/assets/"+B.attributes.id+"/subassets"}if(this.fireEvent("beforeload",this,B,C)!==false){this.transId=Ext.Ajax.request({method:"GET",url:this.dataUrl,disableCaching:true,headers:{Accept:"application/json"},success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:C,node:B},params:""})}else{if(typeof C=="function"){C()}}}});