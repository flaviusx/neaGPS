## lpattachments.vm. Niels P. Mayer
## Template for use by CurrikiStandardLessonPlan and other lesson plans that
## use file attachments. The intent is to use something like set($attachURL =
## $newAsset.getURL("view", "xpage=lpattachments")) to upload attachments to
## $newAsset. $newAsset being the asset being populated, that resides in
## AssetTemp.

## orig code from Groups.MessageSheet

<div id="attachmentscontent" class="xwikiintracontent">
<form id="attachmentAddForm" action="$doc.getURL("upload")" enctype="multipart/form-data" method="post">
<input type="hidden" name="xredirect" value="$xwiki.getFormEncoded($xwiki.getRequestURL())" />
<input id="xwikiuploadname" type="hidden" name="filename" value="" size="40"/>
<input id="xwikiuploadfile" type="file" name="filepath" value="" size="40"/>
<script language="javascript" type="text/javascript" src="$xwiki.getSkinFile("xwiki.js")"></script>
<script type="text/javascript">function updateXRedirect(formName, returnValue){var xredirect = document.forms[formName].xredirect;xredirect.value = '${doc.getURL("view", "xpage=lpattachments")}';return returnValue;}</script>
<input class="button button-orange" type="submit" value="$msg.get("attachthisfile")" onclick="try { return updateXRedirect('attachmentAddForm', updateAttachName(this.form, '$msg.get('doyouwanttoreplace')')); } catch(e) { alert('$msg.get('attachthisfile') button onclick error: ' + e + ' ...'); return false; }" />
</form>
</div>
##
## List of attachments
##
#if($doc.attachmentList.size()>0) ## {
  <p class="instruction">$msg.get("lesson.plan.required.attachments.file.attached")</p>
  <h5 class="instruction">$msg.get("lesson.plan.attachments.title")</h5>
  
  #foreach ($attach in $doc.attachmentList) ## {
    <div class="attachments">
      #mimeicon($attach.filename)
      $attach.version 
      <span class="right"><a href="$doc.getAttachmentURL("${attach.filename}", "delattachment", "xredirect=${redirect}")" onclick="try { return confirm('$msg.get("confirmdelattachment")'); } catch(e) { alert('$msg.get("deletethisattachment") button onclick error: ' + e + ' ...'); return false; }" title="$msg.get("deletethisattachment")">$msg.get("delete")</a></span>
    </div>
  #end ## } -- foreach
#end ## } -- if
